/*
	@preserve ©️ 2023 blue linden software.
	licensed under the GNU AGPL 3.0, all rights reserved.
	proprietary modifications are FORBIDDEN without a custom licensing plan. (https://articleman.org/license)
	this generated code is not meant to be modified in place, and it WILL be overwritten by Articleman's automatic updates and integrity verification. if you'd like to edit it, compile it yourself from https://github.com/bluelinden/articleman.
	compiled with rollup at 1698489904094
*/
/* @preserve disclaimer: the following code may cause you to:
	* love your job
	* become more productive
	* have more fun

	if any of these happen to you, do not panic. Articleman is working as intended and these feelings will not subside.
*/
function onOpen(){}function socketeer(){}function onSelectionChange(){}function showSidebar(){}function onInstall(){}var global=this;!function(t){"function"==typeof define&&define.amd?define(t):t()}((function(){"use strict";function t(e){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(e)}function e(t,e){
return Zt.get(t)&&Zt.get(t).get(e)}function n(t,n,r){if(void 0===n)throw new TypeError;var i=e(n,r);return i&&i.get(t)}function r(n,r,i,o){if(o&&!["string","symbol"].includes(t(o)))throw new TypeError;(e(i,o)||function(t,e){var n=Zt.get(t)||new Map;Zt.set(t,n);var r=n.get(e)||new Map;return n.set(e,r),r}(i,o)).set(n,r)}function i(t,e,r){return n(t,e,r)?n(t,e,r):Object.getPrototypeOf(e)?i(t,Object.getPrototypeOf(e),r):void 0}function o(){return be++}function a(t){
return t instanceof RangeError||t.message===Re}function s(e){return"function"==typeof e?e.name:"symbol"===t(e)?e.toString():e}function c(t,e,n){var r="",i=n(t,e);return 0!==i.length&&(r="\nRegistered bindings:",i.forEach((function(t){var e="Object";null!==t.implementationType&&(e=l(t.implementationType)),r=r+"\n "+e,t.constraint.metaData&&(r=r+" - "+t.constraint.metaData)}))),r}function u(t,e){return null!==t.parentRequest&&(t.parentRequest.serviceIdentifier===e||u(t.parentRequest,e))}
function h(t){t.childRequests.forEach((function(t){if(u(t,t.serviceIdentifier)){var e=function(t){return function t(e,n){void 0===n&&(n=[]);var r=s(e.serviceIdentifier);return n.push(r),null!==e.parentRequest?t(e.parentRequest,n):n}(t).reverse().join(" --\x3e ")}(t);throw Error(Te+" "+e)}h(t)}))}function l(t){if(t.name)return t.name;var e=t.toString(),n=e.match(/^function\s*([^\s(]+)/);return n?n[1]:"Anonymous function: "+e}function d(t,e,n,r){
var i=t.getConstructorMetadata(n),o=i.compilerGeneratedMetadata;if(void 0===o)throw Error(je+" "+e+".");var a=i.userGeneratedMetadata,s=Object.keys(a),c=0===n.length&&s.length>0,u=s.length>n.length,h=function(t,e,n,r,i){for(var o=[],a=0;a<i;a++){var s=f(a,t,e,n,r);null!==s&&o.push(s)}return o}(r,e,o,a,c||u?s.length:n.length),l=g(t,n,e);return We(We([],h,!0),l,!0)}function f(t,e,n,r,i){var o=i[t.toString()]||[],a=v(o),s=!0!==a.unmanaged,c=r[t]
;if((c=a.inject||a.multiInject||c)instanceof Be&&(c=c.unwrap()),s){if(!e&&(c===Object||c===Function||void 0===c))throw Error(Oe+" argument "+t+" in class "+n+".");var u=new Le(ve.ConstructorArgument,a.targetName,c);return u.metadata=o,u}return null}function p(t,e,n,r){var i=t||e;if(void 0===i)throw Error(je+" for property "+n+" in class "+r+".");return i}function g(t,e,n){for(var r=t.getPropertiesMetadata(e),i=[],o=Object.getOwnPropertySymbols(r),a=0,s=Object.keys(r).concat(o);a<s.length;a++){
var c=s[a],u=r[c],h=v(u),l=h.targetName||c,d=p(h.inject,h.multiInject,c,n),f=new Le(ve.ClassProperty,l,d);f.metadata=u,i.push(f)}var y=Object.getPrototypeOf(e.prototype).constructor;if(y!==Object){var b=g(t,y,n);i=We(We([],i,!0),b,!0)}return i}function y(t,e){var n=Object.getPrototypeOf(e.prototype).constructor;if(n!==Object){var r=d(t,l(n),n,!0),i=r.map((function(t){return t.metadata.filter((function(t){return t.key===re}))})),o=[].concat.apply([],i).length,a=r.length-o;return a>0?a:y(t,n)}
return 0}function v(t){var e={};return t.forEach((function(t){e[t.key.toString()]=t.value})),{inject:e[oe],multiInject:e[ae],targetName:e[ne],unmanaged:e[re]}}function b(t){return t._bindingDictionary}function m(t,e,n,r,i){var o,a=_(n.container,i.serviceIdentifier)
;return a.length===Ee.NoBindingsAvailable&&n.container.options.autoBindInjectable&&"function"==typeof i.serviceIdentifier&&t.getConstructorMetadata(i.serviceIdentifier).compilerGeneratedMetadata&&(n.container.bind(i.serviceIdentifier).toSelf(),a=_(n.container,i.serviceIdentifier)),o=e?a:a.filter((function(t){var e=new Ve(t.serviceIdentifier,n,r,t,i);return t.constraint(e)})),function(t,e,n,r){switch(e.length){case Ee.NoBindingsAvailable:if(n.isOptional())return e;var i=s(t),o=Ce
;throw o+=function(t,e){if(e.isTagged()||e.isNamed()){var n="",r=e.getNamedTag(),i=e.getCustomTags();return null!==r&&(n+=r.toString()+"\n"),null!==i&&i.forEach((function(t){n+=t.toString()+"\n"}))," "+t+"\n "+t+" - "+n}return" "+t}(i,n),o+=c(r,i,_),Error(o);case Ee.OnlyOneBindingAvailable:return e;case Ee.MultipleBindingsAvailable:default:if(n.isArray())return e;throw i=s(t),o=Ae+" "+i,o+=c(r,i,_),Error(o)}}(i.serviceIdentifier,o,i,n.container),o}function w(t,e,n,r,i,o){var a,s;if(null===i){
a=m(t,e,r,null,o),s=new Ve(n,r,null,a,o);var c=new Fe(r,s);r.addPlan(c)}else a=m(t,e,r,i,o),s=i.addChildRequest(o.serviceIdentifier,a,o);a.forEach((function(e){var n=null;if(o.isArray())n=s.addChildRequest(e.serviceIdentifier,e,o);else{if(e.cache)return;n=s}if(e.type===ye.Instance&&null!==e.implementationType){var i=function(t,e){return d(t,l(e),e,!1)}(t,e.implementationType);if(!r.container.options.skipBaseClassChecks){var a=y(t,e.implementationType);if(i.length<a){
var c=ke(l(e.implementationType));throw Error(c)}}i.forEach((function(e){w(t,!1,e.serviceIdentifier,r,n,e)}))}}))}function _(t,e){var n=[],r=b(t);return r.hasKey(e)?n=r.get(e):null!==t.parent&&(n=_(t.parent,e)),n}function S(e){return("object"===t(e)&&null!==e||"function"==typeof e)&&"function"==typeof e.then}function A(t){return!!S(t)||Array.isArray(t)&&t.some(S)}function C(t){var e,n=new((e=t.constr).bind.apply(e,He([void 0],t.constructorInjections,!1)))
;return t.propertyRequests.forEach((function(e,r){var i=e.target.identifier,o=t.propertyInjections[r];e.target.isOptional()&&void 0===o||(n[i]=o)})),n}function j(t){return Ge(this,void 0,void 0,(function(){var e,n,r,i;return $e(this,(function(o){for(e=[],n=0,r=t;n<r.length;n++)i=r[n],Array.isArray(i)?e.push(Promise.all(i)):e.push(i);return[2,Promise.all(e)]}))}))}function O(t,e){var n=function(t,e){var n,r;if(Xt.hasMetadata(he,t)){var i=Xt.getMetadata(he,t);try{
return null===(r=(n=e)[i.value])||void 0===r?void 0:r.call(n)}catch(e){if(e instanceof Error)throw Error(Me(t.name,e.message))}}}(t,e);return S(n)?n.then((function(){return e})):e}function T(t,e,n){var r,i=Ze(t.parentContext,e,n),o=nn(t.parentContext.container),a=o.next();do{r=a.value;var s=t.parentContext,c=t.serviceIdentifier,u=en(r,c);i=S(i)?tn(u,s,i):Xe(u,s,i),a=o.next()}while(!0!==a.done&&!b(r).hasKey(t.serviceIdentifier));return i}function I(t,e,n,r){var i=function(t){var e=[]
;if(Array.isArray(t)){var n=function(t){for(var e=new Set,n=0,r=t;n<r.length;n++){var i=r[n];if(e.has(i))return i;e.add(i)}}((e=t).map((function(t){return t.key})));if(void 0!==n)throw Error(we+" "+n.toString())}else e=[t];return e}(r),o={};Xt.hasOwnMetadata(t,e)&&(o=Xt.getMetadata(t,e));var a=o[n];if(void 0===a)a=[];else for(var s=function(t){if(i.some((function(e){return e.key===t.key})))throw Error(we+" "+t.key.toString())},c=0,u=a;c<u.length;c++)s(u[c]);a.push.apply(a,i),o[n]=a,
Xt.defineMetadata(t,o,e)}function k(){return function(t){if(Xt.hasOwnMetadata(ue,t))throw Error("Cannot apply @injectable decorator multiple times.");var e=Xt.getMetadata("design:paramtypes",t)||[];return Xt.defineMetadata(ue,e,t),t}}function M(e,n,r,i){var o,a=arguments.length,s=a<3?n:null===i?i=Object.getOwnPropertyDescriptor(n,r):i
;if("object"===(void 0===Xt?"undefined":t(Xt))&&"function"==typeof Xt.decorate)s=Xt.decorate(e,n,r,i);else for(var c=e.length-1;c>=0;c--)(o=e[c])&&(s=(a<3?o(s):a>3?o(n,r,s):o(n,r))||s);return a>3&&s&&Object.defineProperty(n,r,s),s}function N(e,n){if("object"===(void 0===Xt?"undefined":t(Xt))&&"function"==typeof Xt.metadata)return Xt.metadata(e,n)}function R(t){return null==t?void 0===t?Dn:Rn:En&&En in Object(t)?function(t){var e=In.call(t,Mn),n=t[Mn];try{t[Mn]=void 0;var r=!0}catch(t){}
var i=kn.call(t);return r&&(e?t[Mn]=n:delete t[Mn]),i}(t):function(t){return Nn.call(t)}(t)}function D(e){return null!=e&&"object"==t(e)}function E(e){return"symbol"==t(e)||D(e)&&R(e)==xn}function x(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i}function U(t){if("string"==typeof t)return t;if(Un(t))return x(t,U)+"";if(E(t))return Pn?Pn.call(t):"";var e=t+"";return"0"==e&&1/t==-Fn?"-0":e}function F(e){var n=t(e);return null!=e&&("object"==n||"function"==n)}
function B(t){return t?(t=function(t){if("number"==typeof t)return t;if(E(t))return Vn;if(F(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=F(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;var n;t=(n=t)?n.slice(0,function(t){for(var e=t.length;e--&&Ln.test(t.charAt(e)););return e}(n)+1).replace(Wn,""):n;var r=zn.test(t);return r||Gn.test(t)?$n(t.slice(2),r?2:8):qn.test(t)?Vn:+t}(t))===Hn||t===-Hn?(t<0?-1:1)*Jn:t==t?t:0:0===t?t:0}function P(t){return t}function L(t){if(!F(t))return!1
;var e=R(t);return e==Kn||e==Yn||e==Qn||e==Zn}function W(t,e){var n=function(t,e){return null==t?void 0:t[e]}(t,e);return function(t){return!(!F(t)||(e=t,er&&er in e))&&(L(t)?sr:rr).test(function(t){if(null!=t){try{return nr.call(t)}catch(t){}try{return t+""}catch(t){}}return""}(t));var e}(n)?n:void 0}function V(t){return t!=t}function q(t,e){return!(null==t||!t.length)&&function(t,e,n){return e==e?function(t,e,n){for(var r=-1,i=t.length;++r<i;)if(t[r]===e)return r;return-1
}(t,e):function(t,e,n,r){for(var i=t.length,o=-1;++o<i;)if(e(t[o],o,t))return o;return-1}(t,V)}(t,e)>-1}function z(e,n){var r=t(e);return!!(n=null==n?mr:n)&&("number"==r||"symbol"!=r&&wr.test(e))&&e>-1&&e%1==0&&e<n}function G(t,e,n){"__proto__"==e&&dr?dr(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function $(t,e){return t===e||t!=t&&e!=e}function H(t,e,n){var r=t[e];_r.call(t,e)&&$(r,n)&&(void 0!==n||e in t)||G(t,e,n)}function J(t){
return"number"==typeof t&&t>-1&&t%1==0&&t<=Ar}function Q(t){return null!=t&&J(t.length)&&!L(t)}function K(e,n,r){if(!F(r))return!1;var i=t(n);return!!("number"==i?Q(r)&&z(n,r.length):"string"==i&&n in r)&&$(r[n],e)}function Y(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||Cr)}function Z(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r}function X(t){return D(t)&&"[object Arguments]"==R(t)}function tt(t){
return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}function et(t){return Q(t)?function(t,e){var n=Un(t),r=!n&&kr(t),i=!n&&!r&&Dr(t),o=!n&&!r&&!i&&Wr(t),a=n||r||i||o,s=a?Z(t.length,String):[],c=s.length;for(var u in t)a&&("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||z(u,c))||s.push(u);return s}(t):function(t){if(!F(t))return function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}(t)
;var e=Y(t),n=[];for(var r in t)("constructor"!=r||!e&&Vr.call(t,r))&&n.push(r);return n}(t)}function nt(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function rt(t,e){for(var n=t.length;n--;)if($(t[n][0],e))return n;return-1}function it(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function ot(e,n){var r,i,o=e.__data__
;return("string"==(i=t(r=n))||"number"==i||"symbol"==i||"boolean"==i?"__proto__"!==r:null===r)?o["string"==typeof n?"string":"hash"]:o.map}function at(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}function st(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new TypeError(Kr);var n=function(){var r=arguments,i=e?e.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=t.apply(this,r);return n.cache=o.set(i,a)||o,a}
;return n.cache=new(st.Cache||at),n}function ct(e,n){return Un(e)?e:function(e,n){if(Un(e))return!1;var r=t(e);return!("number"!=r&&"symbol"!=r&&"boolean"!=r&&null!=e&&!E(e))||zr.test(e)||!qr.test(e)||null!=n&&e in Object(n)}(e,n)?[e]:ei(function(t){return null==t?"":U(t)}(e))}function ut(t){if("string"==typeof t||E(t))return t;var e=t+"";return"0"==e&&1/t==-ni?"-0":e}function ht(t,e,n){var r=null==t?void 0:function(t,e){for(var n=0,r=(e=ct(e,t)).length;null!=t&&n<r;)t=t[ut(e[n++])]
;return n&&n==r?t:void 0}(t,e);return void 0===r?n:r}function lt(t){var e=this.__data__=new it(t);this.size=e.size}function dt(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new at;++e<n;)this.add(t[e])}function ft(t,e){return t.has(e)}function pt(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}function gt(t,e,n){(void 0!==n&&!$(t[e],n)||void 0===n&&!(e in t))&&G(t,e,n)}function yt(t){return D(t)&&Q(t)}function vt(t,e){
if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]}function bt(t,e,n,r,i){t!==e&&gi(e,(function(o,a){if(i||(i=new lt),F(o))!function(t,e,n,r,i,o,a){var s,c=vt(t,n),u=vt(e,n),h=a.get(u);if(h)gt(t,n,h);else{var l=o?o(c,u,n+"",t,e,a):void 0,d=void 0===l;if(d){var f=Un(u),p=!f&&Dr(u),g=!f&&!p&&Wr(u);l=u,f||p||g?Un(c)?l=c:yt(c)?l=function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e}(c):p?(d=!1,l=u.slice()):g?(d=!1,l=function(t,e){
var n,r,i=(r=new(n=t.buffer).constructor(n.byteLength),new pi(r).set(new pi(n)),r);return new t.constructor(i,t.byteOffset,t.length)}(u)):l=[]:function(t){if(!D(t)||R(t)!=oi)return!1;var e=ii(t);if(null===e)return!0;var n=ci.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&si.call(n)==ui}(u)||kr(u)?(l=c,kr(c)?l=function(t,e,n,r){var i=!n;n||(n={});for(var o=-1,a=e.length;++o<a;){var s=e[o],c=void 0;void 0===c&&(c=t[s]),i?G(n,s,c):H(n,s,c)}return n
}(s=c,et(s)):F(c)&&!L(c)||(l=function(t){return"function"!=typeof t.constructor||Y(t)?{}:ur(ii(t))}(u))):d=!1}d&&(a.set(u,l),i(l,u,r,o,a),a.delete(u)),gt(t,n,l)}}(t,e,a,n,bt,r,i);else{var s=r?r(vt(t,a),o,a+"",t,e,i):void 0;void 0===s&&(s=o),gt(t,a,s)}}),et)}function mt(t,e,n){if(n&&"boolean"!=typeof n&&K(t,e,n)&&(e=n=void 0),void 0===n&&("boolean"==typeof e?(n=e,e=void 0):"boolean"==typeof t&&(n=t,t=void 0)),void 0===t&&void 0===e?(t=0,e=1):(t=B(t),void 0===e?(e=t,t=0):e=B(e)),t>e){var r=t;t=e,
e=r}if(n||t%1||e%1){var i=Ai();return Si(t+i*(e-t+_i("1e-"+((i+"").length-1))),e)}return function(t,e){return t+mi(wi()*(e-t+1))}(t,e)}function wt(t,e,n){return null==t?t:function(t,e,n,r){if(!F(t))return t;for(var i=-1,o=(e=ct(e,t)).length,a=t;null!=a&&++i<o;){var s=ut(e[i]),c=n;if("__proto__"===s||"constructor"===s||"prototype"===s)return t;if(i!=o-1){var u=a[s];void 0===(c=void 0)&&(c=F(u)?u:z(e[i+1])?[]:{})}H(a,s,c),a=a[s]}return t}(t,e,n)}function _t(t){return t&&t.length?function(t,e,n){
var r=-1,i=q,o=t.length,a=!0,s=[],c=s;if(o>=ji){var u=Ci(t);if(u)return pt(u);a=!1,i=ft,c=new dt}else c=s;t:for(;++r<o;){var h=t[r],l=h;if(h=0!==h?h:0,a&&l==l){for(var d=c.length;d--;)if(c[d]===l)continue t;s.push(h)}else i(c,l,undefined)||(c!==s&&c.push(l),s.push(h))}return s}(t):[]}function St(t){if("string"!=typeof t)throw Error("string cannot be undefined or null");for(var e=[],n=0,r=0;n<t.length;)Tt(t[n+(r+=At(n+r,t))])&&r++,jt(t[n+r])&&r++,Ot(t[n+r])&&r++,
It(t[n+r])?r++:(e.push(t.substring(n,n+r)),n+=r,r=0);return e}function At(t,e){var n=e[t];if(!function(t){return t&&Mt(t[0].charCodeAt(0),Ei,xi)}(n)||t===e.length-1)return 1;var r=n+e[t+1],i=e.substring(t+2,t+5);return Ct(r)&&Ct(i)||function(t){return Mt(kt(t),Pi,Li)}(i)?4:2}function Ct(t){return Mt(kt(t),Fi,Bi)}function jt(t){return"string"==typeof t&&Mt(t.charCodeAt(0),Wi,Vi)}function Ot(t){return"string"==typeof t&&Mt(t.charCodeAt(0),qi,zi)}function Tt(t){
return"string"==typeof t&&-1!==$i.indexOf(t.charCodeAt(0))}function It(t){return"string"==typeof t&&t.charCodeAt(0)===Gi}function kt(t){return(t.charCodeAt(0)-Ei<<10)+(t.charCodeAt(1)-Ui)+65536}function Mt(t,e,n){return t>=e&&t<=n}function Nt(t){throw new TypeError("unsupported data type: "+function(t){return Object.prototype.toString.call(t)}(t))}function Rt(t){let e=0,n=1;for(let r=t.length-1;r>=0;r--){const i=t[r];let o=Zi[i];o*=n,e+=o,n*=Yi}return e}function Dt(t){if(0===t)return Ki[0]
;const e=[];for(;0!==t;){const n=t%Yi,r=Ki[n];e.push(r),t-=n,t/=Yi}return e.reverse().join("")}function Et(t){return t.split("").reverse().join("")}function xt(t){if(t<0)return"-"+xt(-t);let e,[n,r]=t.toString().split(".");if(!r)return Dt(t);r&&([r,e]=r.split("e")),n=Ut(n),r=Et(r),r=Ut(r);let i=n+"."+r;if(e){switch(i+=".",e[0]){case"+":e=e.slice(1);break;case"-":i+="-",e=e.slice(1)}e=Et(e),e=Ut(e),i+=e}return i}function Ut(t){const e=+t;return e.toString()===t?Dt(e):":"+function(t){
const e=BigInt(0),n=BigInt(Yi);if(t===e)return Ki[0];const r=[];for(;t!==e;){const e=t%n,i=Ki[Number(e)];r.push(i),t-=e,t/=n}return r.reverse().join("")}(BigInt(t))}function Ft(t){return":"===t[0]?function(t){let e=BigInt(0),n=BigInt(1);const r=BigInt(Yi);for(let i=t.length-1;i>=0;i--){const o=t[i];let a=BigInt(Zi[o]);a*=n,e+=a,n*=r}return e}(t.substring(1)).toString():Rt(t).toString()}function Bt(t){if("-"===t[0])return-Bt(t.substr(1));let[e,n,r]=t.split(".");if(!n)return Rt(e);e=Ft(e),n=Ft(n),
n=Et(n);let i=e+"."+n;if(r){i+="e";let t=!1;"-"===r[0]&&(t=!0,r=r.slice(1)),r=Ft(r),r=Et(r),i+=t?-r:+r}return+i}function Pt(t){return Bt(t=t.replace("n|",""))}function Lt(){const t=[];return{forEach(e){for(let n=0;n<t.length;n++)if("break"===e(t[n]))return},add(e){t.push(e)},toArray:()=>t}}function Wt(){const t=Object.create(null),e=Object.create(null);return{getValue:e=>t[e],getSchema:t=>e[t],forEachValue(e){for(const[n,r]of Object.entries(t))if("break"===e(n,r))return},forEachSchema(t){
for(const[n,r]of Object.entries(e))if("break"===t(n,r))return},setValue(e,n){t[e]=n},setSchema(t,n){e[t]=n},hasValue:e=>e in t,hasSchema:t=>t in e}}function Vt(t,e){if(t.cache.hasValue(e))return t.cache.getValue(e);const n=xt(t.keyCount++);return t.store.add(e),t.cache.setValue(e,n),n}function qt(t,e,n){if(null===e)return"";switch(typeof e){case"undefined":if(Array.isArray(n))return qt(t,null,n);break;case"object":if(null===e)return Vt(t,null);if(Array.isArray(e)){let n="a"
;for(let r=0;r<e.length;r++){const i=e[r];n+="|"+(null===i?"_":qt(t,i,e))}return"a"===n&&(n="a|"),Vt(t,n)}{const n=Object.keys(e);if(0===n.length)return Vt(t,"o|");let r="o";const i=function(t,e){const n=e.join(",");if(t.cache.hasSchema(n))return t.cache.getSchema(n);const r=qt(t,e,void 0);return t.cache.setSchema(n,r),r}(t,n);r+="|"+i;for(const i of n)r+="|"+qt(t,e[i],e);return Vt(t,r)}case"boolean":return Vt(t,e?"b|T":"b|F");case"number":return Vt(t,"n|"+xt(e));case"string":
return Vt(t,function(t){switch(t[0]+t[1]){case"b|":case"o|":case"n|":case"a|":case"s|":t="s|"+t}return t}(e))}return Nt(e)}function zt(t){const e={store:Lt(),cache:Wt(),keyCount:0},n=qt(e,t,void 0),r=function(t){return t.store.toArray()}(e);return[r,n]}function Gt(t,e){if(""===e||"_"===e)return null;const n=function(t){return"number"==typeof t?t:Rt(t)}(e),r=t[n];if(null===r)return r;switch(typeof r){case"undefined":case"number":return r;case"string":switch(r[0]+r[1]){case"b|":return function(t){
switch(t){case"b|T":return!0;case"b|F":return!1}return!!t}(r);case"o|":return function(t,e){if("o|"===e)return{};const n={},r=e.split("|");let i=Gt(t,r[1]);const o=r.length;o-2!=1||Array.isArray(i)||(i=[i]);for(let e=2;e<o;e++){const o=i[e-2];let a=r[e];a=Gt(t,a),n[o]=a}return n}(t,r);case"n|":return Pt(r);case"a|":return function(t,e){if("a|"===e)return[];const n=e.split("|"),r=n.length-1,i=Array(r);for(let e=0;e<r;e++){let r=n[e+1];r=Gt(t,r),i[e]=r}return i}(t,r);default:
return"s|"===(i=r)[0]+i[1]?i.substr(2):i}}var i;return Nt(r)}function $t(){if(!no&&!(no="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return no(ro)}function Ht(t,e,n){if(ao.randomUUID&&!e&&!t)return ao.randomUUID();var r=(t=t||{}).random||(t.rng||$t)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,e){n=n||0;for(var i=0;i<16;++i)e[n+i]=r[i]
;return e}return function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return io[t[e+0]]+io[t[e+1]]+io[t[e+2]]+io[t[e+3]]+"-"+io[t[e+4]]+io[t[e+5]]+"-"+io[t[e+6]]+io[t[e+7]]+"-"+io[t[e+8]]+io[t[e+9]]+"-"+io[t[e+10]]+io[t[e+11]]+io[t[e+12]]+io[t[e+13]]+io[t[e+14]]+io[t[e+15]]}(r)}function Jt(t,e){switch(e.type){case"group":return e.capabilities.every((e=>t.computedCapabilities.includes(e)));case"user":
return e.computedCapabilities.every((e=>t.computedCapabilities.includes(e)))}}function Qt(t,e){return e.every((e=>t.computedCapabilities.includes(e)))}function Kt(t,e){const n=(t,r)=>{for(let i in t){const o=t[i],a=r?`${r}.${i}`:i;e(o,a),"object"==typeof o&&n(o,a)}};n(t,"")}function Yt(t){switch(!0){case Array.isArray(t):return"array";case"object"==typeof t&&null!==t:return"object";case"boolean"==typeof t:return"boolean";case function(t){return"number"==typeof t||D(t)&&R(t)==vi}(t):
return"number";case"string"==typeof t:return"string";case null===t:return"null";case void 0===t:return"undefined";default:return"unknown"}}var Zt=new WeakMap,Xt={decorate:function(t,e,n,r){if(!Array.isArray(t)||0===t.length)throw new TypeError;return void 0!==n?function(t,e,n,r){return t.reverse().forEach((function(t){r=t(e,n,r)||r})),r}(t,e,n,r):"function"==typeof e?function(t,e){return t.reverse().forEach((function(t){var n=t(e);n&&(e=n)})),e}(t,e):void 0},defineMetadata:function(t,e,n,i){
r(t,e,n,i)},getMetadata:function(t,e,n){return i(t,e,n)},getOwnMetadata:function(t,e,r){return n(t,e,r)},hasMetadata:function(t,e,n){return!!i(t,e,n)},hasOwnMetadata:function(t,e,r){return!!n(t,e,r)},metadata:function(t,e){return function(n,i){r(t,e,n,i)}}};Object.assign(Xt,Xt)
;var te,ee="named",ne="name",re="unmanaged",ie="optional",oe="inject",ae="multi_inject",se="inversify:tagged",ce="inversify:tagged_props",ue="inversify:paramtypes",he="post_construct",le="pre_destroy",de=[oe,ae,ne,re,ee,ie],fe="Request",pe="Singleton",ge="Transient",ye={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"},ve={ClassProperty:"ClassProperty",
ConstructorArgument:"ConstructorArgument",Variable:"Variable"},be=0,me=function(){function t(t,e){this.id=o(),this.activated=!1,this.serviceIdentifier=t,this.scope=e,this.type=ye.Invalid,this.constraint=function(){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.onDeactivation=null,this.dynamicValue=null}return t.prototype.clone=function(){var e=new t(this.serviceIdentifier,this.scope)
;return e.activated=e.scope===pe&&this.activated,e.implementationType=this.implementationType,e.dynamicValue=this.dynamicValue,e.scope=this.scope,e.type=this.type,e.factory=this.factory,e.provider=this.provider,e.constraint=this.constraint,e.onActivation=this.onActivation,e.onDeactivation=this.onDeactivation,e.cache=this.cache,e},t
}(),we="Metadata key was used more than once in a parameter:",_e="NULL argument",Se="Key Not Found",Ae="Ambiguous match found for serviceIdentifier:",Ce="No matching bindings found for serviceIdentifier:",je="Missing required @injectable annotation in:",Oe="Missing required @inject or @multiInject annotation in:",Te="Circular dependency found:",Ie="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.",ke=function(){
for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"The number of constructor arguments in the derived class "+t[0]+" must be >= than the number of constructor arguments of its base class."},Me=function(t,e){return"@postConstruct error in class "+t+": "+e},Ne=function(t,e){return"onDeactivation() error in class "+t+": "+e},Re="Maximum call stack size exceeded",De=function(){function t(){}return t.prototype.getConstructorMetadata=function(t){return{
compilerGeneratedMetadata:Xt.getMetadata(ue,t),userGeneratedMetadata:Xt.getMetadata(se,t)||{}}},t.prototype.getPropertiesMetadata=function(t){return Xt.getMetadata(ce,t)||[]},t}(),Ee={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1},xe=function(){function t(t){this.id=o(),this.container=t}return t.prototype.addPlan=function(t){this.plan=t},t.prototype.setCurrentRequest=function(t){this.currentRequest=t},t}(),Ue=function(){function t(t,e){this.key=t,this.value=e}
return t.prototype.toString=function(){return this.key===ee?"named: "+this.value+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},t}(),Fe=function(t,e){this.parentContext=t,this.rootRequest=e},Be=function(){function t(t){this._cb=t}return t.prototype.unwrap=function(){return this._cb()},t}(),Pe=function(){function t(t){this.str=t}return t.prototype.startsWith=function(t){return 0===this.str.indexOf(t)},t.prototype.endsWith=function(t){var e,n=t.split("").reverse().join("")
;return e=this.str.split("").reverse().join(""),this.startsWith.call({str:e},n)},t.prototype.contains=function(t){return-1!==this.str.indexOf(t)},t.prototype.equals=function(t){return this.str===t},t.prototype.value=function(){return this.str},t}(),Le=function(){function e(e,n,r,i){this.id=o(),this.type=e,this.serviceIdentifier=r;var a="symbol"===t(n)?n.toString().slice(7,-1):n;this.name=new Pe(a||""),this.identifier=n,this.metadata=[];var s=null
;"string"==typeof i?s=new Ue(ee,i):i instanceof Ue&&(s=i),null!==s&&this.metadata.push(s)}return e.prototype.hasTag=function(t){for(var e=0,n=this.metadata;e<n.length;e++)if(n[e].key===t)return!0;return!1},e.prototype.isArray=function(){return this.hasTag(ae)},e.prototype.matchesArray=function(t){return this.matchesTag(ae)(t)},e.prototype.isNamed=function(){return this.hasTag(ee)},e.prototype.isTagged=function(){return this.metadata.some((function(t){return de.every((function(e){return t.key!==e
}))}))},e.prototype.isOptional=function(){return this.matchesTag(ie)(!0)},e.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter((function(t){return t.key===ee}))[0]:null},e.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter((function(t){return de.every((function(e){return t.key!==e}))})):null},e.prototype.matchesNamedTag=function(t){return this.matchesTag(ee)(t)},e.prototype.matchesTag=function(t){var e=this;return function(n){
for(var r=0,i=e.metadata;r<i.length;r++){var o=i[r];if(o.key===t&&o.value===n)return!0}return!1}},e}(),We=function(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))},Ve=function(){function t(t,e,n,r,i){this.id=o(),this.serviceIdentifier=t,this.parentContext=e,this.parentRequest=n,this.target=i,this.childRequests=[],this.bindings=Array.isArray(r)?r:[r],
this.requestScope=null===n?new Map:null}return t.prototype.addChildRequest=function(e,n,r){var i=new t(e,this.parentContext,this,n,r);return this.childRequests.push(i),i},t}();!function(t){t.DynamicValue="toDynamicValue",t.Factory="toFactory",t.Provider="toProvider"}(te||(te={}));var qe,ze=function(){return ze=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},ze.apply(this,arguments)
},Ge=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{c(r.next(t))}catch(t){o(t)}}function s(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((r=r.apply(t,e||[])).next())}))},$e=function(t,e){function n(n){return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,
i&&(o=2&n[0]?i.return:n[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,i=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==n[0]&&2!==n[0])){s=0;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){s.label=n[1];break}if(6===n[0]&&s.label<o[1]){s.label=o[1],o=n;break}
if(o&&s.label<o[2]){s.label=o[2],s.ops.push(n);break}o[2]&&s.ops.pop(),s.trys.pop();continue}n=e.call(t,s)}catch(t){n=[6,t],i=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}var r,i,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},He=function(t,e,n){
if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))},Je=function t(e){return function(n){n.parentContext.setCurrentRequest(n);var r=n.bindings,i=n.childRequests,o=n.target&&n.target.isArray(),a=!(n.parentRequest&&n.parentRequest.target&&n.target&&n.parentRequest.target.matchesArray(n.target.serviceIdentifier));if(o&&a)return i.map((function(n){return t(e)(n)}))
;if(!n.target.isOptional()||0!==r.length){var s=r[0];return Ye(e,n,s)}}},Qe=function(t,e,n){var r,i=e.childRequests;switch(function(t){var e=null;switch(t.type){case ye.ConstantValue:case ye.Function:e=t.cache;break;case ye.Constructor:case ye.Instance:e=t.implementationType;break;case ye.DynamicValue:e=t.dynamicValue;break;case ye.Provider:e=t.provider;break;case ye.Factory:e=t.factory}if(null===e){var n=s(t.serviceIdentifier);throw Error("Invalid binding type: "+n)}}(n),n.type){
case ye.ConstantValue:case ye.Function:r=n.cache;break;case ye.Constructor:r=n.implementationType;break;case ye.Instance:r=function(t,e,n,r){!function(t,e){t.scope!==pe&&function(t,e){var n="Class cannot be instantiated in "+(t.scope===fe?"request":"transient")+" scope.";if("function"==typeof t.onDeactivation)throw Error(Ne(e.name,n));if(Xt.hasMetadata(le,e))throw Error("@preDestroy error in class "+e.name+": "+n)}(t,e)}(t,e);var i=function(t,e,n){var r;if(e.length>0){var i=function(t,e){
return t.reduce((function(t,n){var r=e(n);return n.target.type===ve.ConstructorArgument?t.constructorInjections.push(r):(t.propertyRequests.push(n),t.propertyInjections.push(r)),t.isAsync||(t.isAsync=A(r)),t}),{constructorInjections:[],propertyInjections:[],propertyRequests:[],isAsync:!1})}(e,n),o=ze(ze({},i),{constr:t});r=i.isAsync?function(t){return Ge(this,void 0,void 0,(function(){var e,n;return $e(this,(function(r){switch(r.label){case 0:return[4,j(t.constructorInjections)];case 1:
return e=r.sent(),[4,j(t.propertyInjections)];case 2:return n=r.sent(),[2,C(ze(ze({},t),{constructorInjections:e,propertyInjections:n}))]}}))}))}(o):C(o)}else r=new t;return r}(e,n,r);return S(i)?i.then((function(t){return O(e,t)})):O(e,i)}(n,n.implementationType,i,Je(t));break;default:r=function(t,e){var n=function(t){switch(t.type){case ye.Factory:return{factory:t.factory,factoryType:te.Factory};case ye.Provider:return{factory:t.provider,factoryType:te.Provider};case ye.DynamicValue:return{
factory:t.dynamicValue,factoryType:te.DynamicValue};default:throw Error("Unexpected factory type "+t.type)}}(t);return function(r,i){try{return n.factory.bind(t)(e)}catch(t){throw a(t)&&(t=Error("It looks like there is a circular dependency in one of the '"+n.factoryType+"' bindings. Please investigate bindings with service identifier '"+e.currentRequest.serviceIdentifier.toString()+"'.")),t}}()}(n,e.parentContext)}return r},Ke=function(t,e,n){var r=function(t,e){
return e.scope===pe&&e.activated?e.cache:e.scope===fe&&t.has(e.id)?t.get(e.id):null}(t,e);return null!==r||function(t,e,n){e.scope===pe&&function(t,e){t.cache=e,t.activated=!0,S(e)&&function(t,e){return r=function(){var n,r;return function(t,e){function n(t){return function(n){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(o=2&t[0]?i.return:t[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,t[1])).done)return o;switch(i=0,
o&&(t=[2&t[0],o.value]),t[0]){case 0:case 1:o=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,i=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==t[0]&&2!==t[0])){s=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){s.label=t[1];break}if(6===t[0]&&s.label<o[1]){s.label=o[1],o=t;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(t);break}o[2]&&s.ops.pop(),s.trys.pop();continue}t=e(s)}catch(e){t=[6,e],i=0
}finally{r=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,n])}}var r,i,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a}(0,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,e];case 1:return n=i.sent(),t.cache=n,[3,3];case 2:throw r=i.sent(),t.cache=null,t.activated=!1,r;case 3:return[2]}}))},
new((n=void 0)||(n=Promise))((function(t,e){function i(t){try{a(r.next(t))}catch(t){e(t)}}function o(t){try{a(r.throw(t))}catch(t){e(t)}}function a(e){var r;e.done?t(e.value):(r=e.value,r instanceof n?r:new n((function(t){t(r)}))).then(i,o)}a((r=r.call(void 0)).next())}));var n,r}(t,e)}(e,n),e.scope===fe&&function(t,e,n){t.has(e.id)||t.set(e.id,n)}(t,e,n)}(t,e,r=n()),r},Ye=function(t,e,n){return Ke(t,n,(function(){var r=Qe(t,e,n);return S(r)?r.then((function(t){return T(e,n,t)})):T(e,n,r)}))
},Ze=function(t,e,n){return"function"==typeof e.onActivation?e.onActivation(t,n):n},Xe=function(t,e,n){for(var r=t.next();!r.done;){if(S(n=r.value(e,n)))return tn(t,e,n);r=t.next()}return n},tn=function(t,e,n){return void 0,void 0,i=function(){var r,i;return function(t,e){function n(t){return function(n){return function(t){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(o=2&t[0]?i.return:t[0]?i.throw||((o=i.return)&&o.call(i),
0):i.next)&&!(o=o.call(i,t[1])).done)return o;switch(i=0,o&&(t=[2&t[0],o.value]),t[0]){case 0:case 1:o=t;break;case 4:return s.label++,{value:t[1],done:!1};case 5:s.label++,i=t[1],t=[0];continue;case 7:t=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==t[0]&&2!==t[0])){s=0;continue}if(3===t[0]&&(!o||t[1]>o[0]&&t[1]<o[3])){s.label=t[1];break}if(6===t[0]&&s.label<o[1]){s.label=o[1],o=t;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(t);break}
o[2]&&s.ops.pop(),s.trys.pop();continue}t=e(s)}catch(e){t=[6,e],i=0}finally{r=o=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,n])}}var r,i,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a}(0,(function(o){switch(o.label){case 0:return[4,n];case 1:r=o.sent(),i=t.next(),o.label=2;case 2:return i.done?[3,4]:[4,i.value(e,r)];case 3:
return r=o.sent(),i=t.next(),[3,2];case 4:return[2,r]}}))},new((r=void 0)||(r=Promise))((function(t,e){function n(t){try{a(i.next(t))}catch(t){e(t)}}function o(t){try{a(i.throw(t))}catch(t){e(t)}}function a(e){var i;e.done?t(e.value):(i=e.value,i instanceof r?i:new r((function(t){t(i)}))).then(n,o)}a((i=i.call(undefined)).next())}));var r,i},en=function(t,e){var n=t._activations;return n.hasKey(e)?n.get(e).values():[].values()},nn=function(t){for(var e=[t],n=t.parent;null!==n;)e.push(n),
n=n.parent;return{next:function(){var t=e.pop();return void 0!==t?{done:!1,value:t}:{done:!0,value:void 0}}}},rn=function(t,e){var n=t.parentRequest;return null!==n&&(!!e(n)||rn(n,e))},on=function(t){return function(e){var n=function(n){return null!==n&&null!==n.target&&n.target.matchesTag(t)(e)};return n.metaData=new Ue(t,e),n}},an=on(ee),sn=function(t){return function(e){var n=null;if(null!==e){if(n=e.bindings[0],"string"==typeof t)return n.serviceIdentifier===t
;var r=e.bindings[0].implementationType;return t===r}return!1}},cn=function(){function t(t){this._binding=t}return t.prototype.when=function(t){return this._binding.constraint=t,new un(this._binding)},t.prototype.whenTargetNamed=function(t){return this._binding.constraint=an(t),new un(this._binding)},t.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(t){return null!==t&&null!==t.target&&!t.target.isNamed()&&!t.target.isTagged()},new un(this._binding)},
t.prototype.whenTargetTagged=function(t,e){return this._binding.constraint=on(t)(e),new un(this._binding)},t.prototype.whenInjectedInto=function(t){return this._binding.constraint=function(e){return null!==e&&sn(t)(e.parentRequest)},new un(this._binding)},t.prototype.whenParentNamed=function(t){return this._binding.constraint=function(e){return null!==e&&an(t)(e.parentRequest)},new un(this._binding)},t.prototype.whenParentTagged=function(t,e){return this._binding.constraint=function(n){
return null!==n&&on(t)(e)(n.parentRequest)},new un(this._binding)},t.prototype.whenAnyAncestorIs=function(t){return this._binding.constraint=function(e){return null!==e&&rn(e,sn(t))},new un(this._binding)},t.prototype.whenNoAncestorIs=function(t){return this._binding.constraint=function(e){return null!==e&&!rn(e,sn(t))},new un(this._binding)},t.prototype.whenAnyAncestorNamed=function(t){return this._binding.constraint=function(e){return null!==e&&rn(e,an(t))},new un(this._binding)},
t.prototype.whenNoAncestorNamed=function(t){return this._binding.constraint=function(e){return null!==e&&!rn(e,an(t))},new un(this._binding)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._binding.constraint=function(n){return null!==n&&rn(n,on(t)(e))},new un(this._binding)},t.prototype.whenNoAncestorTagged=function(t,e){return this._binding.constraint=function(n){return null!==n&&!rn(n,on(t)(e))},new un(this._binding)},t.prototype.whenAnyAncestorMatches=function(t){
return this._binding.constraint=function(e){return null!==e&&rn(e,t)},new un(this._binding)},t.prototype.whenNoAncestorMatches=function(t){return this._binding.constraint=function(e){return null!==e&&!rn(e,t)},new un(this._binding)},t}(),un=function(){function t(t){this._binding=t}return t.prototype.onActivation=function(t){return this._binding.onActivation=t,new cn(this._binding)},t.prototype.onDeactivation=function(t){return this._binding.onDeactivation=t,new cn(this._binding)},t
}(),hn=function(){function t(t){this._binding=t,this._bindingWhenSyntax=new cn(this._binding),this._bindingOnSyntax=new un(this._binding)}return t.prototype.when=function(t){return this._bindingWhenSyntax.when(t)},t.prototype.whenTargetNamed=function(t){return this._bindingWhenSyntax.whenTargetNamed(t)},t.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},t.prototype.whenTargetTagged=function(t,e){return this._bindingWhenSyntax.whenTargetTagged(t,e)},
t.prototype.whenInjectedInto=function(t){return this._bindingWhenSyntax.whenInjectedInto(t)},t.prototype.whenParentNamed=function(t){return this._bindingWhenSyntax.whenParentNamed(t)},t.prototype.whenParentTagged=function(t,e){return this._bindingWhenSyntax.whenParentTagged(t,e)},t.prototype.whenAnyAncestorIs=function(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)},t.prototype.whenNoAncestorIs=function(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)},
t.prototype.whenAnyAncestorNamed=function(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,e)},t.prototype.whenNoAncestorNamed=function(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)},t.prototype.whenNoAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenNoAncestorTagged(t,e)},t.prototype.whenAnyAncestorMatches=function(t){
return this._bindingWhenSyntax.whenAnyAncestorMatches(t)},t.prototype.whenNoAncestorMatches=function(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)},t.prototype.onActivation=function(t){return this._bindingOnSyntax.onActivation(t)},t.prototype.onDeactivation=function(t){return this._bindingOnSyntax.onDeactivation(t)},t}(),ln=function(){function t(t){this._binding=t}return t.prototype.inRequestScope=function(){return this._binding.scope=fe,new hn(this._binding)},
t.prototype.inSingletonScope=function(){return this._binding.scope=pe,new hn(this._binding)},t.prototype.inTransientScope=function(){return this._binding.scope=ge,new hn(this._binding)},t}(),dn=function(){function t(t){this._binding=t,this._bindingWhenSyntax=new cn(this._binding),this._bindingOnSyntax=new un(this._binding),this._bindingInSyntax=new ln(t)}return t.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},t.prototype.inSingletonScope=function(){
return this._bindingInSyntax.inSingletonScope()},t.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},t.prototype.when=function(t){return this._bindingWhenSyntax.when(t)},t.prototype.whenTargetNamed=function(t){return this._bindingWhenSyntax.whenTargetNamed(t)},t.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},t.prototype.whenTargetTagged=function(t,e){return this._bindingWhenSyntax.whenTargetTagged(t,e)},
t.prototype.whenInjectedInto=function(t){return this._bindingWhenSyntax.whenInjectedInto(t)},t.prototype.whenParentNamed=function(t){return this._bindingWhenSyntax.whenParentNamed(t)},t.prototype.whenParentTagged=function(t,e){return this._bindingWhenSyntax.whenParentTagged(t,e)},t.prototype.whenAnyAncestorIs=function(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)},t.prototype.whenNoAncestorIs=function(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)},
t.prototype.whenAnyAncestorNamed=function(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,e)},t.prototype.whenNoAncestorNamed=function(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)},t.prototype.whenNoAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenNoAncestorTagged(t,e)},t.prototype.whenAnyAncestorMatches=function(t){
return this._bindingWhenSyntax.whenAnyAncestorMatches(t)},t.prototype.whenNoAncestorMatches=function(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)},t.prototype.onActivation=function(t){return this._bindingOnSyntax.onActivation(t)},t.prototype.onDeactivation=function(t){return this._bindingOnSyntax.onDeactivation(t)},t}(),fn=function(){function t(t){this._binding=t}return t.prototype.to=function(t){return this._binding.type=ye.Instance,this._binding.implementationType=t,
new dn(this._binding)},t.prototype.toSelf=function(){if("function"!=typeof this._binding.serviceIdentifier)throw Error("The toSelf function can only be applied when a constructor is used as service identifier");var t=this._binding.serviceIdentifier;return this.to(t)},t.prototype.toConstantValue=function(t){return this._binding.type=ye.ConstantValue,this._binding.cache=t,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=pe,new hn(this._binding)},
t.prototype.toDynamicValue=function(t){return this._binding.type=ye.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=t,this._binding.implementationType=null,new dn(this._binding)},t.prototype.toConstructor=function(t){return this._binding.type=ye.Constructor,this._binding.implementationType=t,this._binding.scope=pe,new hn(this._binding)},t.prototype.toFactory=function(t){return this._binding.type=ye.Factory,this._binding.factory=t,this._binding.scope=pe,new hn(this._binding)},
t.prototype.toFunction=function(t){if("function"!=typeof t)throw Error("Value provided to function binding must be a function!");var e=this.toConstantValue(t);return this._binding.type=ye.Function,this._binding.scope=pe,e},t.prototype.toAutoFactory=function(t){return this._binding.type=ye.Factory,this._binding.factory=function(e){return function(){return e.container.get(t)}},this._binding.scope=pe,new hn(this._binding)},t.prototype.toAutoNamedFactory=function(t){
return this._binding.type=ye.Factory,this._binding.factory=function(e){return function(n){return e.container.getNamed(t,n)}},new hn(this._binding)},t.prototype.toProvider=function(t){return this._binding.type=ye.Provider,this._binding.provider=t,this._binding.scope=pe,new hn(this._binding)},t.prototype.toService=function(t){this.toDynamicValue((function(e){return e.container.get(t)}))},t}(),pn=function(){function t(){}return t.of=function(e,n,r,i,o){var a=new t;return a.bindings=e,
a.middleware=n,a.deactivations=i,a.activations=r,a.moduleActivationStore=o,a},t}(),gn=function(){function e(){this._map=new Map}return e.prototype.getMap=function(){return this._map},e.prototype.add=function(t,e){if(null==t)throw Error(_e);if(null==e)throw Error(_e);var n=this._map.get(t);void 0!==n?n.push(e):this._map.set(t,[e])},e.prototype.get=function(t){if(null==t)throw Error(_e);var e=this._map.get(t);if(void 0!==e)return e;throw Error(Se)},e.prototype.remove=function(t){
if(null==t)throw Error(_e);if(!this._map.delete(t))throw Error(Se)},e.prototype.removeIntersection=function(t){var e=this;this.traverse((function(n,r){var i=t.hasKey(n)?t.get(n):void 0;if(void 0!==i){var o=r.filter((function(t){return!i.some((function(e){return t===e}))}));e._setValue(n,o)}}))},e.prototype.removeByCondition=function(t){var e=this,n=[];return this._map.forEach((function(r,i){for(var o=[],a=0,s=r;a<s.length;a++){var c=s[a];t(c)?n.push(c):o.push(c)}e._setValue(i,o)})),n},
e.prototype.hasKey=function(t){if(null==t)throw Error(_e);return this._map.has(t)},e.prototype.clone=function(){var n=new e;return this._map.forEach((function(e,r){e.forEach((function(e){return n.add(r,"object"===t(i=e)&&null!==i&&"clone"in i&&"function"==typeof i.clone?e.clone():e);var i}))})),n},e.prototype.traverse=function(t){this._map.forEach((function(e,n){t(n,e)}))},e.prototype._setValue=function(t,e){e.length>0?this._map.set(t,e):this._map.delete(t)},e}(),yn=function(){function t(){
this._map=new Map}return t.prototype.remove=function(t){if(this._map.has(t)){var e=this._map.get(t);return this._map.delete(t),e}return this._getEmptyHandlersStore()},t.prototype.addDeactivation=function(t,e,n){this._getModuleActivationHandlers(t).onDeactivations.add(e,n)},t.prototype.addActivation=function(t,e,n){this._getModuleActivationHandlers(t).onActivations.add(e,n)},t.prototype.clone=function(){var e=new t;return this._map.forEach((function(t,n){e._map.set(n,{
onActivations:t.onActivations.clone(),onDeactivations:t.onDeactivations.clone()})})),e},t.prototype._getModuleActivationHandlers=function(t){var e=this._map.get(t);return void 0===e&&(e=this._getEmptyHandlersStore(),this._map.set(t,e)),e},t.prototype._getEmptyHandlersStore=function(){return{onActivations:new gn,onDeactivations:new gn}},t}(),vn=function(){return vn=Object.assign||function(t){
for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},vn.apply(this,arguments)},bn=function(t,e,n,r){return new(n||(n=Promise))((function(i,o){function a(t){try{c(r.next(t))}catch(t){o(t)}}function s(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((r=r.apply(t,e||[])).next())}))},mn=function(t,e){function n(n){
return function(a){return function(n){if(r)throw new TypeError("Generator is already executing.");for(;s;)try{if(r=1,i&&(o=2&n[0]?i.return:n[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,n[1])).done)return o;switch(i=0,o&&(n=[2&n[0],o.value]),n[0]){case 0:case 1:o=n;break;case 4:return s.label++,{value:n[1],done:!1};case 5:s.label++,i=n[1],n=[0];continue;case 7:n=s.ops.pop(),s.trys.pop();continue;default:if(!((o=(o=s.trys).length>0&&o[o.length-1])||6!==n[0]&&2!==n[0])){s=0
;continue}if(3===n[0]&&(!o||n[1]>o[0]&&n[1]<o[3])){s.label=n[1];break}if(6===n[0]&&s.label<o[1]){s.label=o[1],o=n;break}if(o&&s.label<o[2]){s.label=o[2],s.ops.push(n);break}o[2]&&s.ops.pop(),s.trys.pop();continue}n=e.call(t,s)}catch(t){n=[6,t],i=0}finally{r=o=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}var r,i,o,a,s={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},
"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},wn=function(){function e(e){var n=e||{};if("object"!==t(n))throw Error("Invalid Container constructor argument. Container options must be an object.");if(void 0===n.defaultScope)n.defaultScope=ge;else if(n.defaultScope!==pe&&n.defaultScope!==ge&&n.defaultScope!==fe)throw Error('Invalid Container option. Default scope must be a string ("singleton" or "transient").')
;if(void 0===n.autoBindInjectable)n.autoBindInjectable=!1;else if("boolean"!=typeof n.autoBindInjectable)throw Error("Invalid Container option. Auto bind injectable must be a boolean");if(void 0===n.skipBaseClassChecks)n.skipBaseClassChecks=!1;else if("boolean"!=typeof n.skipBaseClassChecks)throw Error("Invalid Container option. Skip base check must be a boolean");this.options={autoBindInjectable:n.autoBindInjectable,defaultScope:n.defaultScope,skipBaseClassChecks:n.skipBaseClassChecks},
this.id=o(),this._bindingDictionary=new gn,this._snapshots=[],this._middleware=null,this._activations=new gn,this._deactivations=new gn,this.parent=null,this._metadataReader=new De,this._moduleActivationStore=new yn}return e.merge=function(t,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var o=new e,a=function(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i])
;return t.concat(r||Array.prototype.slice.call(e))}([t,n],r,!0).map((function(t){return b(t)})),s=b(o);return a.forEach((function(t){var e;e=s,t.traverse((function(t,n){n.forEach((function(t){e.add(t.serviceIdentifier,t.clone())}))}))})),o},e.prototype.load=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=this._getContainerModuleHelpersFactory(),r=0,i=t;r<i.length;r++){var o=i[r],a=n(o.id)
;o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction,a.unbindAsyncFunction,a.onActivationFunction,a.onDeactivationFunction)}},e.prototype.loadAsync=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return bn(this,void 0,void 0,(function(){var e,n,r,i,o;return mn(this,(function(a){switch(a.label){case 0:e=this._getContainerModuleHelpersFactory(),n=0,r=t,a.label=1;case 1:return n<r.length?(i=r[n],o=e(i.id),
[4,i.registry(o.bindFunction,o.unbindFunction,o.isboundFunction,o.rebindFunction,o.unbindAsyncFunction,o.onActivationFunction,o.onDeactivationFunction)]):[3,4];case 2:a.sent(),a.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},e.prototype.unload=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];e.forEach((function(e){var n=t._removeModuleBindings(e.id);t._deactivateSingletons(n),t._removeModuleHandlers(e.id)}))},e.prototype.unloadAsync=function(){
for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return bn(this,void 0,void 0,(function(){var e,n,r,i;return mn(this,(function(o){switch(o.label){case 0:e=0,n=t,o.label=1;case 1:return e<n.length?(r=n[e],i=this._removeModuleBindings(r.id),[4,this._deactivateSingletonsAsync(i)]):[3,4];case 2:o.sent(),this._removeModuleHandlers(r.id),o.label=3;case 3:return e++,[3,1];case 4:return[2]}}))}))},e.prototype.bind=function(t){var e=this.options.defaultScope||ge,n=new me(t,e)
;return this._bindingDictionary.add(t,n),new fn(n)},e.prototype.rebind=function(t){return this.unbind(t),this.bind(t)},e.prototype.rebindAsync=function(t){return bn(this,void 0,void 0,(function(){return mn(this,(function(e){switch(e.label){case 0:return[4,this.unbindAsync(t)];case 1:return e.sent(),[2,this.bind(t)]}}))}))},e.prototype.unbind=function(t){if(this._bindingDictionary.hasKey(t)){var e=this._bindingDictionary.get(t);this._deactivateSingletons(e)}this._removeServiceFromDictionary(t)},
e.prototype.unbindAsync=function(t){return bn(this,void 0,void 0,(function(){var e;return mn(this,(function(n){switch(n.label){case 0:return this._bindingDictionary.hasKey(t)?(e=this._bindingDictionary.get(t),[4,this._deactivateSingletonsAsync(e)]):[3,2];case 1:n.sent(),n.label=2;case 2:return this._removeServiceFromDictionary(t),[2]}}))}))},e.prototype.unbindAll=function(){var t=this;this._bindingDictionary.traverse((function(e,n){t._deactivateSingletons(n)})),this._bindingDictionary=new gn},
e.prototype.unbindAllAsync=function(){return bn(this,void 0,void 0,(function(){var t,e=this;return mn(this,(function(n){switch(n.label){case 0:return t=[],this._bindingDictionary.traverse((function(n,r){t.push(e._deactivateSingletonsAsync(r))})),[4,Promise.all(t)];case 1:return n.sent(),this._bindingDictionary=new gn,[2]}}))}))},e.prototype.onActivation=function(t,e){this._activations.add(t,e)},e.prototype.onDeactivation=function(t,e){this._deactivations.add(t,e)},
e.prototype.isBound=function(t){var e=this._bindingDictionary.hasKey(t);return!e&&this.parent&&(e=this.parent.isBound(t)),e},e.prototype.isCurrentBound=function(t){return this._bindingDictionary.hasKey(t)},e.prototype.isBoundNamed=function(t,e){return this.isBoundTagged(t,ee,e)},e.prototype.isBoundTagged=function(t,e,n){var r=!1;if(this._bindingDictionary.hasKey(t)){var i=this._bindingDictionary.get(t),o=function(t,e,n,r){var i=new Le(ve.Variable,"",e,new Ue(n,r)),o=new xe(t)
;return new Ve(e,o,null,[],i)}(this,t,e,n);r=i.some((function(t){return t.constraint(o)}))}return!r&&this.parent&&(r=this.parent.isBoundTagged(t,e,n)),r},e.prototype.snapshot=function(){this._snapshots.push(pn.of(this._bindingDictionary.clone(),this._middleware,this._activations.clone(),this._deactivations.clone(),this._moduleActivationStore.clone()))},e.prototype.restore=function(){var t=this._snapshots.pop();if(void 0===t)throw Error("No snapshot available to restore.")
;this._bindingDictionary=t.bindings,this._activations=t.activations,this._deactivations=t.deactivations,this._middleware=t.middleware,this._moduleActivationStore=t.moduleActivationStore},e.prototype.createChild=function(t){var n=new e(t||this.options);return n.parent=this,n},e.prototype.applyMiddleware=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=t.reduce((function(t,e){return e(t)}),n)},
e.prototype.applyCustomMetadataReader=function(t){this._metadataReader=t},e.prototype.get=function(t){var e=this._getNotAllArgs(t,!1);return this._getButThrowIfAsync(e)},e.prototype.getAsync=function(t){return bn(this,void 0,void 0,(function(){var e;return mn(this,(function(n){return e=this._getNotAllArgs(t,!1),[2,this._get(e)]}))}))},e.prototype.getTagged=function(t,e,n){var r=this._getNotAllArgs(t,!1,e,n);return this._getButThrowIfAsync(r)},e.prototype.getTaggedAsync=function(t,e,n){
return bn(this,void 0,void 0,(function(){var r;return mn(this,(function(i){return r=this._getNotAllArgs(t,!1,e,n),[2,this._get(r)]}))}))},e.prototype.getNamed=function(t,e){return this.getTagged(t,ee,e)},e.prototype.getNamedAsync=function(t,e){return this.getTaggedAsync(t,ee,e)},e.prototype.getAll=function(t){var e=this._getAllArgs(t);return this._getButThrowIfAsync(e)},e.prototype.getAllAsync=function(t){var e=this._getAllArgs(t);return this._getAll(e)},e.prototype.getAllTagged=function(t,e,n){
var r=this._getNotAllArgs(t,!0,e,n);return this._getButThrowIfAsync(r)},e.prototype.getAllTaggedAsync=function(t,e,n){var r=this._getNotAllArgs(t,!0,e,n);return this._getAll(r)},e.prototype.getAllNamed=function(t,e){return this.getAllTagged(t,ee,e)},e.prototype.getAllNamedAsync=function(t,e){return this.getAllTaggedAsync(t,ee,e)},e.prototype.resolve=function(t){var e=this.isBound(t);e||this.bind(t).toSelf();var n=this.get(t);return e||this.unbind(t),n},e.prototype._preDestroy=function(t,e){
var n,r;if(Xt.hasMetadata(le,t))return null===(r=(n=e)[Xt.getMetadata(le,t).value])||void 0===r?void 0:r.call(n)},e.prototype._removeModuleHandlers=function(t){var e=this._moduleActivationStore.remove(t);this._activations.removeIntersection(e.onActivations),this._deactivations.removeIntersection(e.onDeactivations)},e.prototype._removeModuleBindings=function(t){return this._bindingDictionary.removeByCondition((function(e){return e.moduleId===t}))},e.prototype._deactivate=function(t,e){
var n=this,r=Object.getPrototypeOf(e).constructor;try{if(this._deactivations.hasKey(t.serviceIdentifier)){var i=this._deactivateContainer(e,this._deactivations.get(t.serviceIdentifier).values());if(S(i))return this._handleDeactivationError(i.then((function(){return n._propagateContainerDeactivationThenBindingAndPreDestroyAsync(t,e,r)})),r)}var o=this._propagateContainerDeactivationThenBindingAndPreDestroy(t,e,r);if(S(o))return this._handleDeactivationError(o,r)}catch(t){
if(t instanceof Error)throw Error(Ne(r.name,t.message))}},e.prototype._handleDeactivationError=function(t,e){return bn(this,void 0,void 0,(function(){var n;return mn(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,t];case 1:return r.sent(),[3,3];case 2:if((n=r.sent())instanceof Error)throw Error(Ne(e.name,n.message));return[3,3];case 3:return[2]}}))}))},e.prototype._deactivateContainer=function(t,e){for(var n=this,r=e.next();r.value;){var i=r.value(t)
;if(S(i))return i.then((function(){return n._deactivateContainerAsync(t,e)}));r=e.next()}},e.prototype._deactivateContainerAsync=function(t,e){return bn(this,void 0,void 0,(function(){var n;return mn(this,(function(r){switch(r.label){case 0:n=e.next(),r.label=1;case 1:return n.value?[4,n.value(t)]:[3,3];case 2:return r.sent(),n=e.next(),[3,1];case 3:return[2]}}))}))},e.prototype._getContainerModuleHelpersFactory=function(){var t=this,e=function(t,e){t._binding.moduleId=e},n=function(n){
return function(r){var i=t.rebind(r);return e(i,n),i}},r=function(e){return function(n,r){t._moduleActivationStore.addActivation(e,n,r),t.onActivation(n,r)}},i=function(e){return function(n,r){t._moduleActivationStore.addDeactivation(e,n,r),t.onDeactivation(n,r)}};return function(o){return{bindFunction:(a=o,function(n){var r=t.bind(n);return e(r,a),r}),isboundFunction:function(e){return t.isBound(e)},onActivationFunction:r(o),onDeactivationFunction:i(o),rebindFunction:n(o),
unbindFunction:function(e){return t.unbind(e)},unbindAsyncFunction:function(e){return t.unbindAsync(e)}};var a}},e.prototype._getAll=function(t){return Promise.all(this._get(t))},e.prototype._get=function(t){var e=vn(vn({},t),{contextInterceptor:function(t){return t},targetType:ve.Variable});if(this._middleware){var n=this._middleware(e);if(null==n)throw Error("Invalid return type in middleware. Middleware must return!");return n}return this._planAndResolve()(e)},
e.prototype._getButThrowIfAsync=function(t){var e=this._get(t);if(A(e))throw Error("You are attempting to construct '"+t.serviceIdentifier+"' in a synchronous way\n but it has asynchronous dependencies.");return e},e.prototype._getAllArgs=function(t){return{avoidConstraints:!0,isMultiInject:!0,serviceIdentifier:t}},e.prototype._getNotAllArgs=function(t,e,n,r){return{avoidConstraints:!1,isMultiInject:e,serviceIdentifier:t,key:n,value:r}},e.prototype._planAndResolve=function(){var t=this
;return function(e){var n=function(t,e,n,r,i,o,s,c){void 0===c&&(c=!1);var u=new xe(e),l=function(t,e,n,r,i,o){var a=new Ue(t?ae:oe,n),s=new Le(e,"",n,a);if(void 0!==i){var c=new Ue(i,o);s.metadata.push(c)}return s}(n,r,i,0,o,s);try{return w(t,c,i,u,null,l),u}catch(t){throw a(t)&&h(u.plan.rootRequest),t}}(t._metadataReader,t,e.isMultiInject,e.targetType,e.serviceIdentifier,e.key,e.value,e.avoidConstraints);return function(t){return Je(t.plan.rootRequest.requestScope)(t.plan.rootRequest)
}(n=e.contextInterceptor(n))}},e.prototype._deactivateIfSingleton=function(t){var e=this;if(t.activated)return S(t.cache)?t.cache.then((function(n){return e._deactivate(t,n)})):this._deactivate(t,t.cache)},e.prototype._deactivateSingletons=function(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if(S(this._deactivateIfSingleton(r)))throw Error("Attempting to unbind dependency with asynchronous destruction (@preDestroy or onDeactivation)")}},e.prototype._deactivateSingletonsAsync=function(t){
return bn(this,void 0,void 0,(function(){var e=this;return mn(this,(function(n){switch(n.label){case 0:return[4,Promise.all(t.map((function(t){return e._deactivateIfSingleton(t)})))];case 1:return n.sent(),[2]}}))}))},e.prototype._propagateContainerDeactivationThenBindingAndPreDestroy=function(t,e,n){return this.parent?this._deactivate.bind(this.parent)(t,e):this._bindingDeactivationAndPreDestroy(t,e,n)},e.prototype._propagateContainerDeactivationThenBindingAndPreDestroyAsync=function(t,e,n){
return bn(this,void 0,void 0,(function(){return mn(this,(function(r){switch(r.label){case 0:return this.parent?[4,this._deactivate.bind(this.parent)(t,e)]:[3,2];case 1:return r.sent(),[3,4];case 2:return[4,this._bindingDeactivationAndPreDestroyAsync(t,e,n)];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))},e.prototype._removeServiceFromDictionary=function(t){try{this._bindingDictionary.remove(t)}catch(e){throw Error("Could not unbind serviceIdentifier: "+s(t))}},
e.prototype._bindingDeactivationAndPreDestroy=function(t,e,n){var r=this;if("function"==typeof t.onDeactivation){var i=t.onDeactivation(e);if(S(i))return i.then((function(){return r._preDestroy(n,e)}))}return this._preDestroy(n,e)},e.prototype._bindingDeactivationAndPreDestroyAsync=function(t,e,n){return bn(this,void 0,void 0,(function(){return mn(this,(function(r){switch(r.label){case 0:return"function"!=typeof t.onDeactivation?[3,2]:[4,t.onDeactivation(e)];case 1:r.sent(),r.label=2;case 2:
return[4,this._preDestroy(n,e)];case 3:return r.sent(),[2]}}))}))},e}(),_n=(qe=oe,function(t){return function(e,n,r){if(void 0===t){var i="function"==typeof e?e.name:e.constructor.name;throw Error("@inject called with undefined this could mean that the class "+i+" has a circular dependency problem. You can use a LazyServiceIdentifier to  overcome this limitation.")}return(o=new Ue(qe,t),function(t,e,n){"number"==typeof n?function(t,e,n,r){!function(t){if(void 0!==t)throw Error(Ie)}(e),
I(se,t,n.toString(),r)}(t,e,n,o):function(t,e,n){if(void 0!==t.prototype)throw Error(Ie);I(ce,t.constructor,e,n)}(t,e,o)})(e,n,r);var o}});const Sn={Surgical:Symbol("Surgical"),Matrix:Symbol("MatrixBackend"),User:Symbol("UserManager"),Storage:Symbol("StorageManager"),Settings:Symbol("SettingsManager"),Socketeer:Symbol("Socketeer"),Turnstile:Symbol("Turnstile")},An="object"==(void 0===global?"undefined":t(global))&&global&&global.Object===Object&&global
;var Cn="object"==("undefined"==typeof self?"undefined":t(self))&&self&&self.Object===Object&&self;const jn=An||Cn||Function("return this")(),On=jn.Symbol;var Tn=Object.prototype,In=Tn.hasOwnProperty,kn=Tn.toString,Mn=On?On.toStringTag:void 0,Nn=Object.prototype.toString,Rn="[object Null]",Dn="[object Undefined]",En=On?On.toStringTag:void 0,xn="[object Symbol]";const Un=Array.isArray
;var Fn=1/0,Bn=On?On.prototype:void 0,Pn=Bn?Bn.toString:void 0,Ln=/\s/,Wn=/^\s+/,Vn=NaN,qn=/^[-+]0x[0-9a-f]+$/i,zn=/^0b[01]+$/i,Gn=/^0o[0-7]+$/i,$n=parseInt,Hn=1/0,Jn=17976931348623157e292,Qn="[object AsyncFunction]",Kn="[object Function]",Yn="[object GeneratorFunction]",Zn="[object Proxy]";const Xn=jn["__core-js_shared__"]
;var tr,er=(tr=/[^.]+$/.exec(Xn&&Xn.keys&&Xn.keys.IE_PROTO||""))?"Symbol(src)_1."+tr:"",nr=Function.prototype.toString,rr=/^\[object .+?Constructor\]$/,ir=Object.prototype,or=Function.prototype.toString,ar=ir.hasOwnProperty,sr=RegExp("^"+or.call(ar).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),cr=Object.create;const ur=function(){function t(){}return function(e){if(!F(e))return{};if(cr)return cr(e);t.prototype=e;var n=new t
;return t.prototype=void 0,n}}();var hr=Date.now,lr=function(){try{var t=W(Object,"defineProperty");return t({},"",{}),t}catch(t){}}();const dr=lr;var fr,pr,gr,yr=dr?function(t,e){return dr(t,"toString",{configurable:!0,enumerable:!1,value:(n=e,function(){return n}),writable:!0});var n}:P,vr=(fr=yr,pr=0,gr=0,function(){var t=hr(),e=16-(t-gr);if(gr=t,e>0){if(++pr>=800)return arguments[0]}else pr=0;return fr.apply(void 0,arguments)});const br=vr
;var mr=9007199254740991,wr=/^(?:0|[1-9]\d*)$/,_r=Object.prototype.hasOwnProperty,Sr=Math.max,Ar=9007199254740991,Cr=Object.prototype,jr=Object.prototype,Or=jr.hasOwnProperty,Tr=jr.propertyIsEnumerable,Ir=X(function(){return arguments}())?X:function(t){return D(t)&&Or.call(t,"callee")&&!Tr.call(t,"callee")};const kr=Ir
;var Mr="object"==("undefined"==typeof exports?"undefined":t(exports))&&exports&&!exports.nodeType&&exports,Nr=Mr&&"object"==("undefined"==typeof module?"undefined":t(module))&&module&&!module.nodeType&&module,Rr=Nr&&Nr.exports===Mr?jn.Buffer:void 0;const Dr=(Rr?Rr.isBuffer:void 0)||function(){return!1};var Er={}
;Er["[object Float32Array]"]=Er["[object Float64Array]"]=Er["[object Int8Array]"]=Er["[object Int16Array]"]=Er["[object Int32Array]"]=Er["[object Uint8Array]"]=Er["[object Uint8ClampedArray]"]=Er["[object Uint16Array]"]=Er["[object Uint32Array]"]=!0,
Er["[object Arguments]"]=Er["[object Array]"]=Er["[object ArrayBuffer]"]=Er["[object Boolean]"]=Er["[object DataView]"]=Er["[object Date]"]=Er["[object Error]"]=Er["[object Function]"]=Er["[object Map]"]=Er["[object Number]"]=Er["[object Object]"]=Er["[object RegExp]"]=Er["[object Set]"]=Er["[object String]"]=Er["[object WeakMap]"]=!1
;var xr="object"==("undefined"==typeof exports?"undefined":t(exports))&&exports&&!exports.nodeType&&exports,Ur=xr&&"object"==("undefined"==typeof module?"undefined":t(module))&&module&&!module.nodeType&&module,Fr=Ur&&Ur.exports===xr&&An.process,Br=function(){try{return Ur&&Ur.require&&Ur.require("util").types||Fr&&Fr.binding&&Fr.binding("util")}catch(t){}}(),Pr=Br&&Br.isTypedArray,Lr=Pr?function(t){return function(e){return t(e)}}(Pr):function(t){return D(t)&&J(t.length)&&!!Er[R(t)]};const Wr=Lr
;Object.prototype.hasOwnProperty;var Vr=Object.prototype.hasOwnProperty,qr=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,zr=/^\w*$/;const Gr=W(Object,"create");var $r=Object.prototype.hasOwnProperty,Hr=Object.prototype.hasOwnProperty;nt.prototype.clear=function(){this.__data__=Gr?Gr(null):{},this.size=0},nt.prototype.delete=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},nt.prototype.get=function(t){var e=this.__data__;if(Gr){var n=e[t]
;return"__lodash_hash_undefined__"===n?void 0:n}return $r.call(e,t)?e[t]:void 0},nt.prototype.has=function(t){var e=this.__data__;return Gr?void 0!==e[t]:Hr.call(e,t)},nt.prototype.set=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=Gr&&void 0===e?"__lodash_hash_undefined__":e,this};var Jr=Array.prototype.splice;it.prototype.clear=function(){this.__data__=[],this.size=0},it.prototype.delete=function(t){var e=this.__data__,n=rt(e,t)
;return!(n<0||(n==e.length-1?e.pop():Jr.call(e,n,1),--this.size,0))},it.prototype.get=function(t){var e=this.__data__,n=rt(e,t);return n<0?void 0:e[n][1]},it.prototype.has=function(t){return rt(this.__data__,t)>-1},it.prototype.set=function(t,e){var n=this.__data__,r=rt(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this};const Qr=W(jn,"Map");at.prototype.clear=function(){this.size=0,this.__data__={hash:new nt,map:new(Qr||it),string:new nt}},at.prototype.delete=function(t){
var e=ot(this,t).delete(t);return this.size-=e?1:0,e},at.prototype.get=function(t){return ot(this,t).get(t)},at.prototype.has=function(t){return ot(this,t).has(t)},at.prototype.set=function(t,e){var n=ot(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};var Kr="Expected a function";st.Cache=at;var Yr,Zr,Xr=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,ti=/\\(\\)?/g;const ei=(Yr=st((function(t){var e=[]
;return 46===t.charCodeAt(0)&&e.push(""),t.replace(Xr,(function(t,n,r,i){e.push(r?i.replace(ti,"$1"):n||t)})),e}),(function(t){return 500===Zr.size&&Zr.clear(),t})),Zr=Yr.cache,Yr);var ni=1/0,ri=function(t,e){return function(n){return t(e(n))}}(Object.getPrototypeOf,Object);const ii=ri;var oi="[object Object]",ai=Object.prototype,si=Function.prototype.toString,ci=ai.hasOwnProperty,ui=si.call(Object);lt.prototype.clear=function(){this.__data__=new it,this.size=0},lt.prototype.delete=function(t){
var e=this.__data__,n=e.delete(t);return this.size=e.size,n},lt.prototype.get=function(t){return this.__data__.get(t)},lt.prototype.has=function(t){return this.__data__.has(t)},lt.prototype.set=function(t,e){var n=this.__data__;if(n instanceof it){var r=n.__data__;if(!Qr||r.length<199)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new at(r)}return n.set(t,e),this.size=n.size,this}
;var hi="object"==("undefined"==typeof exports?"undefined":t(exports))&&exports&&!exports.nodeType&&exports,li=hi&&"object"==("undefined"==typeof module?"undefined":t(module))&&module&&!module.nodeType&&module,di=li&&li.exports===hi?jn.Buffer:void 0;di&&di.allocUnsafe;const fi=W(jn,"Set"),pi=jn.Uint8Array;dt.prototype.add=dt.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},dt.prototype.has=function(t){return this.__data__.has(t)};const gi=function(t,e,n){
for(var r=-1,i=Object(t),o=n(t),a=o.length;a--;){var s=o[++r];if(!1===e(i[s],s,i))break}return t};var yi,vi="[object Number]";const bi=(yi=function(t,e,n){bt(t,e,n)},function(t,e){return br(function(t,e,n){return e=Sr(void 0===e?1:e,0),function(){for(var r=arguments,i=-1,o=Sr(r.length-e,0),a=Array(o);++i<o;)a[i]=r[e+i];i=-1;for(var s=Array(e+1);++i<e;)s[i]=r[i];return s[e]=n(a),function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1])
;case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}(t,this,s)}}(t,void 0,P),t+"")}((function(t,e){var n=-1,r=e.length,i=r>1?e[r-1]:void 0,o=r>2?e[2]:void 0;for(i=void 0,o&&K(e[0],e[1],o)&&(i=r<3?void 0:i,r=1),t=Object(t);++n<r;){var a=e[n];a&&yi(t,a,n)}return t})));var mi=Math.floor,wi=Math.random,_i=parseFloat,Si=Math.min,Ai=Math.random;const Ci=fi&&1/pt(new fi([,-0]))[1]==1/0?function(t){return new fi(t)}:function(){};var ji=200,Oi=Math.max;let Ti=class{newQuery(t){
return new ki(t,this)}newObject(t){var e,n,r,i;wt(this,"this.changeset.create.objects."+t.id,{position:t.position,type:t.type,sheetId:null!==(e=t.sheetId)&&void 0!==e?e:void 0}),Object.keys(null!==(n=t.attributes)&&void 0!==n?n:{}).length>0&&wt(this,"this.changeset.update.objects."+t.id,{attributes:null!==(r=t.attributes)&&void 0!==r?r:{},isDefinitive:null!==(i=t.isDefinitive)&&void 0!==i&&i}),this.autoCommit&&this.commit()}newAttribute(t){wt(this,"this.changeset.update.objects."+t.id,{
position:t.position,type:t.type,sheetId:t.sheetId}),this.autoCommit&&this.commit()}updateObject(t){var e,n;wt(this,"this.changeset.update.objects."+t.id,{position:t.position,attributes:null!==(e=t.attributes)&&void 0!==e?e:{},isDefinitive:null!==(n=t.isDefinitive)&&void 0!==n&&n}),this.autoCommit&&this.commit()}updateAttribute(t){wt(this,"this.changeset.update.attributes."+t.id,{position:t.position}),this.autoCommit&&this.commit()}deleteObject(t){wt(this,"this.changeset.delete.objects."+t.id,{
type:t.type}),this.autoCommit&&this.commit()}deleteAttribute(t){wt(this,"this.changeset.delete.attributes."+t.id,{type:t.type}),this.autoCommit&&this.commit()}commit(){this.autoCommit?this.changeset.create&&Object.keys(this.changeset.create).length||this.changeset.update&&Object.keys(this.changeset.update).length||this.changeset.delete&&Object.keys(this.changeset.delete).length?(this.backend.applyChangeset(this.changeset),this.changeset={create:{},update:{},delete:{}
}):console.info("No changes to commit."):this.backend.applyChangeset(this.changeset)}getAllObjectsForSheet(t){return this.backend.getObjectsFromSheet(t)}getObject(t){return this.backend.getObject(t)}getObjects(...t){return this.backend.getObjects(...t)}firstRun(){this.backend.initializeEngine(this.backend.spreadsheet)}initializeSheet(t){this.backend.initializeSheet(t)}loadTemplate(t){this.backend.loadTemplate(t)}editCallback(t){this.backend.editCallBack&&this.backend.editCallBack(t)}
changeCallBack(t){}getLastModifiedForObject(t){return this.backend.getLastModified(t)}getChangeQueue(){return this.backend.getChangeQueue()}setChangeQueue(t){this.backend.setChangeQueue(t)}getSheetForObject(t){return this.backend.getSheetForObject(t)}getSheetForAttribute(t){return this.backend.getSheetForAttribute(t)}getSheetById(t){return this.backend.spreadsheet.getSheets().find((e=>e.getSheetId().toString()===t))}};M([_n(Sn.Matrix),N("design:type",Function)],Ti.prototype,"backend",void 0),
Ti=M([k()],Ti);const Ii=Ti;class ki{addGroup(){const t=new Mi;return this.groups.push(t),t}run(){for(const t of this.groups)this.query.push(t.searchGroup);return this.groups=[],this.engine.backend.runQuery(this.query,this.source)}constructor(t,e){this.query=[],this.source=t,this.groups=[],this.engine=e}}class Mi{addEqualsSearch(t,e,n=!0){this.searchGroup.push({attribute:t,match:{type:"equals",value:e,polarity:n}})}addContainsSearch(t,e,n=!0){this.searchGroup.push({attribute:t,match:{
type:"contains",value:e,polarity:n}})}addIsContainedSearch(t,e,n=!0){this.searchGroup.push({attribute:t,match:{type:"iscontained",value:e,polarity:n}})}addBetweenSearch(t,e,n=!0){this.searchGroup.push({attribute:t,match:{type:"between",values:e,polarity:n}})}addFilledSearch(t,e){this.searchGroup.push({attribute:t,match:{type:"filled",value:e}})}}var Ni;!function(t){t.horizontalObjects="horizontal-objects",t.verticalObjects="vertical-objects",t.headerRows="header-rows",
t.headerColumns="header-columns",t.multisheet="multisheet",t.sideBySide="side-by-side"}(Ni||(Ni={}));var Ri={exports:{}},Di={exports:{}},Ei=55296,xi=56319,Ui=56320,Fi=127462,Bi=127487,Pi=127995,Li=127999,Wi=65024,Vi=65039,qi=8400,zi=8447,Gi=8205,$i=[776,2359,2359,2367,2367,2984,3007,3021,3633,3635,3648,3657,4352,4449,4520];Di.exports=St,Di.exports.substr=function(t,e,n){var r=St(t);if(void 0===e)return t;if(e>=r.length)return"";var i=r.length-e,o=e+(void 0===n?i:n);return o>e+i&&(o=void 0),
r.slice(e,o).join("")};var Hi=Di.exports,Ji=function(t){return function(t){return"string"==typeof t?t.replace(function(){var t=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).onlyFirst;return RegExp("[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)|(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-ntqry=><~]))",void 0!==t&&t?void 0:"g")}(),""):t
}(t).match((e="[\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff\\u1ab0-\\u1aff\\u1dc0-\\u1dff]",n="\\ud83c[\\udffb-\\udfff]",r="(?:".concat(e,"|").concat(n,")"),i="[^\\ud800-\\udfff]",o="(?:\\uD83C[\\uDDE6-\\uDDFF]){2}",a="[\\ud800-\\udbff][\\udc00-\\udfff]",s="".concat(r,"?"),c="[\\ufe0e\\ufe0f]?",u="(?:\\u200d(?:".concat([i,o,a].join("|"),")").concat(c+s,")*"),h="".concat(i).concat(e,"?"),
l="(?:".concat([h,e,o,a,"[\\ud800-\\udfff]|[\\uD83D\\uDC69\\uD83C\\uDFFB\\u200D\\uD83C\\uDF93]"].join("|"),")"),RegExp("".concat("(?:\\ud83c\\udff4\\udb40\\udc67\\udb40\\udc62\\udb40(?:\\udc65|\\udc73|\\udc77)\\udb40(?:\\udc6e|\\udc63|\\udc6c)\\udb40(?:\\udc67|\\udc74|\\udc73)\\udb40\\udc7f)","|").concat(n,"(?=").concat(n,")|").concat(l+(c+s+u)),"g"))).length;var e,n,r,i,o,a,s,c,u,h,l};!function(t,e){function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e){var n=e.size,r=e.unicodeAware
;return t=t||"",void 0!==r&&r?function(t,e){for(var n=(0,o.default)(t),r=Math.ceil(n/e),a=Array(r),s=0,c=0,u=(0,i.default)(t);s<r;++s,c+=e)a[s]=u.slice(c,c+e).join("");return a}(t,n):function(t,e){for(var n=t.length,r=Math.ceil(n/e),i=Array(r),o=0,a=0;o<r;++o,a+=e)i[o]=t.substr(a,e);return i}(t,n)}Object.defineProperty(e,"__esModule",{value:!0}),e.default=r;var i=n(Hi),o=n(Ji);t.exports=r}(Ri,Ri.exports);const Qi=tt(Ri.exports);let Ki="";for(let t=0;t<10;t++)Ki+=String.fromCharCode(48+t)
;for(let t=0;t<26;t++)Ki+=String.fromCharCode(65+t);for(let t=0;t<26;t++)Ki+=String.fromCharCode(97+t);const Yi=Ki.length,Zi={};for(let t=0;t<Yi;t++){const e=Ki[t];Zi[e]=t}let Xi=class{};Xi.universal="ARTICLEMAN_STORAGE_",Xi.legend="_LEGEND";let to=class{constructor(){this.document={getStored:t=>this.getFromStorage("document",t),store:(t,e)=>this.setStorage("document",t,e),mergeStore:(t,e)=>this.document.store(t,bi(this.document.getStored(t),e)),cache:(t,e)=>{this.setCache("document",t,e)},
cacheFast:(t,e)=>{this.setCache("document",t,e,!0)},getCached:t=>this.getFromCache("document",t),getCachedFast:t=>this.getFromCache("document",t,!0),deleteStored:t=>this.setStorage("document",t,null)},this.script={getStored:t=>this.getFromStorage("script",t),store:(t,e)=>this.setStorage("script",t,e),mergeStore:(t,e)=>this.script.store(t,bi(this.script.getStored(t),e)),cache:(t,e)=>{this.setCache("script",t,e)},cacheFast:(t,e)=>{this.setCache("script",t,e,!0)},
getCached:t=>this.getFromCache("script",t),getCachedFast:t=>this.getFromCache("script",t,!0),deleteStored:t=>this.setStorage("script",t,null)},this.user={getStored:t=>this.getFromStorage("user",t),store:(t,e)=>this.setStorage("user",t,e),mergeStore:(t,e)=>this.user.store(t,bi(this.user.getStored(t),e)),cache:(t,e)=>{this.setCache("user",t,e)},cacheFast:(t,e)=>{this.setCache("user",t,e,!0)},getCached:t=>this.getFromCache("user",t),getCachedFast:t=>this.getFromCache("user",t,!0),
deleteStored:t=>this.setStorage("user",t,null)},this.documentStorage=PropertiesService.getDocumentProperties(),this.documentCache=CacheService.getScriptCache(),this.userStorage=PropertiesService.getUserProperties(),this.userCache=CacheService.getUserCache(),this.scriptStorage=PropertiesService.getScriptProperties(),this.scriptCache=CacheService.getScriptCache()}getFromStorage(t,e,n){const r=this.getScopedStorage(t),i=r.getProperty(Xi.universal+e+Xi.legend)
;if(!i)throw Error("Legend not found for specified key");const o=JSON.parse(i),a=r.getProperties();return this.unFormat(o,e,a,null!=n?n:void 0)}unFormat(t,e,n,r){if(0===Object.keys(t).length)return null;const i=[];for(let r=0;r<t.length;r++)i.push(n[Xi.universal+e+"_"+r]);const o=i.join(""),a=Utilities.computeDigest(Utilities.DigestAlgorithm.MD5,o).map((t=>("0"+(255&t).toString(16)).slice(-2))).join("")
;if(a===t.digest||"UNSAFELY_ALLOW_BAD_DIGESTS"===r)return"STRING"===t.type?o:t.isCompressed?function(t){const[e,n]=t;return Gt(e,n)}(JSON.parse(o)):JSON.parse(o);if("UNSAFELY_ALLOW_BAD_DIGESTS"!==r)throw Error(`this data couldn't be retrieved and/or stored losslessly. The digests don't match. Expected ${t.digest}, got ${a}. Use UNSAFELY_ALLOW_BAD_DIGESTS to ignore the digest check.`)}format(t,e,n=!0,r=!0,i=9100){let o,a=typeof e,s=!1
;"object"!==a||Array.isArray(e)||null===e||!0!==n?o=JSON.stringify(e):(o=JSON.stringify(zt(e)),s=!0);const c={};let u="";!0===r&&(u=Utilities.computeDigest(Utilities.DigestAlgorithm.MD5,o,Utilities.Charset.UTF_8).map((t=>("0"+(255&t).toString(16)).slice(-2))).join(""));let h=0;return o.length>i?Qi(o,{size:i}).forEach((e=>{h++,c[Xi.universal+t+"_"+h]=e})):c[Xi.universal+t]=o,c[Xi.universal+t+Xi.legend]=JSON.stringify({length:h,type:a,isCompressed:s,
note:"!!!!    This storage is NOT modifiable! Do not try to directly modify any value here or anywhere else in the Properties service that has the ARTICLEMAN_STORAGE namespace. Articleman compresses, and by extension obfuscates all data stored by this, and checks digests when reading! If you would like to modify this storage, either enter Developer Mode as an admin or recompile the app yourself, importing the 'lib/storage-manager' API when writing code.     !!!!",digest:u}),c}
getScopedStorage(t){switch(t){case"document":return PropertiesService.getDocumentProperties();case"script":return PropertiesService.getScriptProperties();case"user":return PropertiesService.getUserProperties();default:throw Error("Unknown scope")}}getScopedCache(t){switch(t){case"document":return CacheService.getDocumentCache();case"script":return CacheService.getScriptCache();case"user":return CacheService.getUserCache();default:throw Error("Unknown scope")}}getFromCache(t,e,n=!1){
const r=this.getScopedCache(t),i=r.get(Xi.universal+e+Xi.legend);if(!i)throw Error(`Legend not found for specified key ${e}. StorageManager needs a legend to function properly.`);const o=JSON.parse(i),a=[];for(let t=0;t<o.length;t++){const n=Xi.universal+e+"_"+t;a.push(n)}const s=r.getAll(a);return this.unFormat(o,e,s,n?"UNSAFELY_ALLOW_BAD_DIGESTS":void 0)}setCache(t,e,n,r=!1){const i=this.getScopedCache(t),o=this.format(e,n,!1,!r,1e8);i.putAll(o)}setStorage(t,e,n){const r=this.turnstile
;r.enter(1e3,!0).then((()=>{const i=this.getScopedStorage(t),o=this.format(e,n,!0);i.setProperties(o),r.exit()}))}};M([_n(Sn.Turnstile),N("design:type",Function)],to.prototype,"turnstile",void 0),to=M([k(),N("design:paramtypes",[])],to);const eo=to;for(var no,ro=new Uint8Array(16),io=[],oo=0;oo<256;++oo)io.push((oo+256).toString(16).slice(1));const ao={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};var so;let co=class{};so=co,
co.universal="SURGICAL_ENGINE_MATRIX_",co.object=so.universal+"OBJECT_",co.attribute=so.universal+"ATTRIBUTE_",co.layout=so.universal+"LAYOUT",co.ignore=so.universal+"IGNORE_",co.header=so.ignore+"HEADER_",co.generalIgnore=so.ignore+"GENERAL_",co.changeTracking="change-tracking",co.changeTrackingLookup=so.changeTracking+"-lookup",co.changeTrackingQueue=so.changeTracking+"-queue";let uo=class{constructor(){
this.supportedLayouts=[Ni.headerRows,Ni.headerColumns,Ni.horizontalObjects,Ni.verticalObjects]}init(t){this.spreadsheet=t}initializeEngine(t){return this.StorageManager.document.store(co.changeTrackingLookup,{0:{0:0}}),this}initializeSheet(t){return this}loadTemplate(t){for(const e in t.objects){const n=this.spreadsheet.getRange(t.objects[e]);this.spreadsheet.setNamedRange(co.object+e,n)}for(const e in t.attributes){const n=this.spreadsheet.getRange(t.objects[e])
;this.spreadsheet.setNamedRange(co.attribute+e,n)}for(const e in Object.keys(t.sheetLayouts)){const n=this.getSheetById(e);n&&n.addDeveloperMetadata(co.layout,t.sheetLayouts[e])}for(const e in t.ignoredAreas.headers){const t=Ht(),n=this.spreadsheet.getRange(e);this.spreadsheet.setNamedRange(co.header+t,n)}for(const e in t.ignoredAreas.generalAreas){const t=Ht(),n=this.spreadsheet.getRange(e);this.spreadsheet.setNamedRange(co.generalIgnore+t,n)}return this}getSheetById(t){
return this.spreadsheet.getSheets().find((e=>e.getSheetId().toString()===t))}getObject(t){const e=this.spreadsheet.getRangeByName(co.object+t),n=null==e?void 0:e.getSheet(),r=[];for(const t in null==n?void 0:n.getNamedRanges())t.startsWith(co.attribute)&&r.push(t);const i={},o=this.getLastModified(t);for(const t in r){const n=this.spreadsheet.getRangeByName(r[t]);n&&e&&(i[t]=this.intersectRanges(n,e))}return{attributes:i,lastModified:o,id:t}}getObjects(...t){return t.map((t=>this.getObject(t)))}
applyChangeset(t){var e,n,r,i,o,a,s,c;if(t.create)for(const e in t.create.attributes){const n=t.create.attributes[e];if(n.position)if(n.position.range)this.ingestNewRangeByNotation(n.position.range,"ATTRIBUTE",e);else if(void 0!==n.sheetId){const t=this.getSheetById(n.sheetId);if(t)switch(n.type){case"ingest":n.position.offset&&this.ingestNewRangeByOffset(t,"ATTRIBUTE",n.position.offset,e);break;case"append":this.appendAttribute(t,e);case"hidden":this.appendAttribute(t,e),
this.hideData(e,"attribute")}}}if(SpreadsheetApp.flush(),t.create)for(const r in t.create.objects){const i=t.create.objects[r];if(void 0!==i.sheetId){const t=this.getSheetById(i.sheetId);if(t)switch(i.type){case"append":this.appendObject(t,r);break;case"ingest":(null===(e=i.position)||void 0===e?void 0:e.range)?this.ingestNewRangeByNotation(i.position.range,"OBJECT",r):(null===(n=i.position)||void 0===n?void 0:n.offset)&&this.ingestNewRangeByOffset(t,"OBJECT",i.position.offset,r)}}}
SpreadsheetApp.flush();for(const e in null===(r=t.update)||void 0===r?void 0:r.attributes){const n=t.update.attributes[e];(null===(i=n.position)||void 0===i?void 0:i.offset)&&this.moveDataByOffset(e,"attribute",n.position.offset)}SpreadsheetApp.flush();for(const e in null===(o=t.update)||void 0===o?void 0:o.objects){const n=t.update.objects[e],r=this.spreadsheet.getRangeByName(co.object+e)
;if((null===(a=n.position)||void 0===a?void 0:a.offset)&&this.moveDataByOffset(e,"object",n.position.offset),n.isDefinitive){const t=null==r?void 0:r.getSheet().getNamedRanges().filter((t=>{t.getName().startsWith(co.attribute)}));if(t)for(const e of t)e&&r&&this.intersectRanges(r,e.getRange()).setValue("")}for(const t in n.attributes){const e=this.spreadsheet.getRangeByName(co.attribute+t);if(!r||!t||!e)continue;const i=this.intersectRanges(r,e),o=n.attributes[t];i.setValue(o)}}
if(SpreadsheetApp.flush(),t.delete)for(const e in t.delete.attributes)switch(t.delete.attributes[e].type){case"splice":this.deleteData(e,"attribute");break;case"ignore":const t=this.spreadsheet.getRangeByName(co.attribute+e);if(!t)continue;this.spreadsheet.setNamedRange(co.ignore+e,t),null===(s=t.getSheet().getNamedRanges().find((t=>t.getName()===co.attribute+e)))||void 0===s||s.remove();break;case"hide":this.hideData(e,"attribute")}if(SpreadsheetApp.flush(),
t.delete)for(const e in t.delete.objects)switch(t.delete.objects[e].type){case"splice":this.deleteData(e,"object");break;case"ignore":const t=this.spreadsheet.getRangeByName(co.object+e);if(!t)continue;this.spreadsheet.setNamedRange(co.generalIgnore+e,t),null===(c=t.getSheet().getNamedRanges().find((t=>t.getName()===co.object+e)))||void 0===c||c.remove();break;case"hide":this.hideData(e,"object")}return SpreadsheetApp.flush(),this}runQuery(t,e){let n=[]
;n=e instanceof Array?e:this.getObjectsFromSheet(e);const r=[];for(const e of n){const n=[];for(const r of t){const t=[];for(const n of r){const r=e.attributes[n.attribute];switch(n.match.type){case"equals":t.push(n.match.polarity?r===n.match.value:r!==n.match.value);break;case"contains":if("string"!=typeof r)throw new lo("Attempted to use a contain search on an attribute that is not a string")
;if("string"!=typeof n.match.value)throw new lo("Attempted to search a value using a contain search that is not a string");t.push(n.match.polarity?r.toString().includes(n.match.value):!r.toString().includes(n.match.value));break;case"iscontained":if("string"!=typeof r)throw new lo("Attempted to use an iscontained search on an attribute that is not a string");if("string"!=typeof n.match.value)throw new lo("Attempted to search a value using an iscontained search that is not a string")
;t.push(n.match.polarity?n.match.value.toString().includes(r):!n.match.value.toString().includes(r));break;case"between":if("number"!=typeof r)throw new lo("Attempted to use a between search on an attribute that is not a number");const e=r>=n.match.values[0]&&r<=n.match.values[1]||r<=n.match.values[0]&&r>=n.match.values[1];t.push(n.match.polarity?e:!e);break;case"filled":t.push(n.match.value?""!==r:""===r)}}t.every((t=>!0===t))?n.push(!0):n.push(!1)}n.some((t=>!0===t))&&r.push(e)}return r}
appendAttribute(t,e){const n=this.findEmptySpace(t,"after-content-end","attribute");if(n)return this.spreadsheet.setNamedRange(co.attribute+e,n),t.getNamedRanges().find((t=>t.getName()===co.attribute+e))}appendObject(t,e){const n=this.findEmptySpace(t,"after-content-end","object");if(n)return this.spreadsheet.setNamedRange(co.object+e,n),t.getNamedRanges().find((t=>t.getName()===co.object+e))}ingestNewRangeByNotation(t,e,n){const r=this.spreadsheet.getRange(t)
;this.spreadsheet.setNamedRange(("ATTRIBUTE"===e?co.attribute:co.object)+n,r)}ingestNewRangeByOffset(t,e,n,r){switch(this.getSheetLayout(t)){case"vertical":const i=this.spreadsheet.getLastColumn()+n+1;this.spreadsheet.setNamedRange(("ATTRIBUTE"===e?co.attribute:co.object)+r,t.getRange(i,1,1,t.getLastColumn()));break;case"horizontal":const o=this.spreadsheet.getLastRow()+n+1;this.spreadsheet.setNamedRange(("ATTRIBUTE"===e?co.attribute:co.object)+r,t.getRange(1,o,t.getLastRow(),1))}}
intersectRanges(t,e){const n=t.getSheet(),r=Math.max(t.getRow(),e.getRow()),i=Math.max(t.getColumn(),e.getColumn());return n.getRange(r,i)}moveDataByOffset(t,e,n){const r=this.spreadsheet.getRangeByName(("attribute"===e?co.attribute:co.object)+t);if(!r)return;const i=r.getSheet(),o=this.getSheetLayout(i);switch(!0){case"attribute"===e&&"vertical"===o||"object"===e&&"horizontal"===o:r.offset(0,n);break;case"attribute"===e&&"horizontal"===o||"object"===e&&"vertical"===o:r.offset(n,0)}}
hideData(t,e){const n=this.spreadsheet.getRangeByName(("attribute"===e?co.attribute:co.object)+t);if(!n)return;const r=this.getSheetLayout(n.getSheet());switch(!0){case"vertical"===r&&"object"===e||"horizontal"===r&&"attribute"===e:this.spreadsheet.hideColumn(n);break;case"vertical"===r&&"attribute"===e||"horizontal"===r&&"object"===e:this.spreadsheet.hideRow(n)}}deleteData(t,e){const n=this.spreadsheet.getRangeByName(("attribute"===e?co.attribute:co.object)+t);if(!n)return
;const r=this.getSheetLayout(n.getSheet());switch(!0){case"vertical"===r&&"object"===e||"horizontal"===r&&"attribute"===e:n.getSheet().deleteColumn(n.getColumn());break;case"vertical"===r&&"attribute"===e||"horizontal"===r&&"object"===e:n.getSheet().deleteRow(n.getRow())}}getSheetLayout(t){var e;const n=null===(e=t.getDeveloperMetadata().find((t=>t.getKey()===co.layout)))||void 0===e?void 0:e.getValue();if(n){if("vertical"!==n&&"horizontal"!==n)throw new lo("Invalid layout");return n}}
getObjectsFromSheet(t){const e=t.getNamedRanges().filter((t=>t.getName().startsWith(co.attribute))),n=t.getNamedRanges().filter((t=>t.getName().startsWith(co.object)));t.getNamedRanges().filter((t=>t.getName().startsWith(co.ignore)));const r=[];let i=[];const o={},a={};switch(this.getSheetLayout(t)){case"horizontal":i=t.getDataRange().getValues();for(const t of n)o[t.getName().split(co.object)[1]]=t.getRange().getRow()-1
;for(const t of e)a[t.getName().split(co.attribute)[1]]=t.getRange().getColumn()-1;break;case"vertical":i=function(t){if(!t||!t.length)return[];var e=0;return t=function(t,e){for(var n=-1,r=null==t?0:t.length,i=0,o=[];++n<r;){var a=t[n];e(a)&&(o[i++]=a)}return o}(t,(function(t){if(yt(t))return e=Oi(t.length,e),!0})),Z(e,(function(e){return x(t,(n=e,function(t){return null==t?void 0:t[n]}));var n}))}(t.getDataRange().getValues())
;for(const t of n)o[t.getName().split(co.object)[1]]=t.getRange().getColumn()-1;for(const t of e)a[t.getName().split(co.attribute)[1]]=t.getRange().getRow()-1}for(const t in o){const e={};for(const n in a)e[n]=i[o[t]][a[n]];r.push({id:t,attributes:e,lastModified:this.getLastModified(t)})}return r}findEmptySpace(t,e,n){const r=this.getSheetLayout(t);switch(!0){case"vertical"===r&&"object"===n||"horizontal"===r&&"attribute"===n:switch(e){case"first-available":for(let e=1;e<t.getLastColumn();e++){
const n=t.getRange(1,e,t.getLastRow(),1);if(this.isRangeEmpty(n))return n}case"after-content-end":return t.getRange(1,t.getLastColumn()+1,t.getLastRow(),1)||t.insertColumnAfter(t.getLastColumn()),t.getRange(1,t.getLastColumn()+1,t.getLastRow(),1)}case"vertical"===r&&"attribute"===n||"horizontal"===r&&"object"===n:switch(e){case"first-available":for(let e=1;e<t.getLastRow();e++){const n=t.getRange(e,1,1,t.getLastColumn());if(this.isRangeEmpty(n))return n}case"after-content-end":
return t.getRange(t.getLastRow()+1,1,1,t.getLastColumn())||t.insertRowAfter(t.getLastColumn()),t.getRange(t.getLastRow()+1,1,1,t.getLastColumn())}}}getSheetForAttribute(t){const e=this.spreadsheet.getRangeByName(co.attribute+t);if(!e)throw Error("Sheet for given attribute id not found.");return e.getSheet()}getSheetForObject(t){const e=this.spreadsheet.getRangeByName(co.object+t);if(!e)throw Error("Sheet for given object id not found.");return e.getSheet()}isRangeEmpty(t){const e=t.getSheet()
;if(!this.isRangeIgnored(e,t)){const n=this.getIterableRange(t);for(const t of n)if(!this.isRangeIgnored(e,t)&&t.getValue())return!1;return!0}}*getIterableRange(t){switch(!0){case 1===t.getHeight()&&t.getWidth()>1:for(let e=1;e<t.getWidth();e++)yield t.getCell(1,e);break;case t.getHeight()>1&&1===t.getWidth():for(let e=1;e<t.getHeight();e++)yield t.getCell(e,1);break;case 1===t.getHeight()&&1===t.getWidth():yield t.getCell(1,1);break;case t.getHeight()>1&&t.getWidth()>1:
for(let e=1;e<t.getHeight();e++)for(let n=1;n<t.getWidth();n++)yield t.getCell(e,n);default:throw new lo("The input range used for iteration is an in incorrect format. Please use a one-dimensional range, conforming to the TypeScript type GoogleAppsScript.Spreadsheet.Range.")}}isRangeIgnored(t,e){return t.getNamedRanges().filter((t=>{t.getName().startsWith(co.ignore)})).forEach((t=>{if(this.isRangeContainedIn(e,t.getRange()))return!0})),!1}isRangeContainedIn(t,e){
if(t.getA1Notation()===e.getA1Notation()&&t.getSheet().getName()===e.getSheet().getName())return!0;const n=t.getRow(),r=t.getColumn(),i=n+t.getHeight()-1,o=r+t.getWidth()-1,a=e.getRow(),s=e.getColumn(),c=a+e.getHeight()-1,u=s+e.getWidth()-1;return n>=a&&i<=c&&r>=s&&o<=u}doRangesIntersect(t,e){var n=t.getRow(),r=n+t.getNumRows()-1,i=t.getColumn(),o=i+t.getNumColumns()-1,a=e.getRow(),s=a+e.getNumRows()-1,c=e.getColumn(),u=c+e.getNumColumns()-1;return n<=s&&a<=r&&i<=u&&c<=o}commitLastModified(t,e){
const n=new this.turnstile(co.changeTrackingLookup,"document");n.enter(1e3,!0).then((()=>{const t=this.StorageManager.document.getStored(co.changeTracking),r=this.StorageManager.document.getStored(co.changeTrackingQueue),i=(new Date).getTime();for(const n in e){const o=e[n].object,a=e[n].attribute;wt(t,[o,a],i),r.push({object:o,attribute:a,date:i})}this.StorageManager.document.store(co.changeTrackingLookup,t),this.StorageManager.document.store(co.changeTrackingQueue,r),n.exit()})).catch((()=>{
throw Error("Failed to commit last modified, turnstile timed out.")}))}getLastModified(t){var e;const n=this.StorageManager.document.getStored(co.changeTrackingLookup);if(t)return null!==(e=n[t])&&void 0!==e?e:void 0}getChangeQueue(){return this.StorageManager.document.getStored(co.changeTrackingQueue)}setChangeQueue(t){this.StorageManager.document.store(co.changeTrackingQueue,t)}editCallBack(t){
const e=[...this.getIterableRange(t.range)],n=t.range.getSheet(),r=n.getNamedRanges().filter((t=>!t.getName().startsWith(co.ignore)&&!!t.getName().startsWith(co.object))),i=n.getNamedRanges().filter((t=>!t.getName().startsWith(co.ignore)&&!!t.getName().startsWith(co.attribute))),o=e.map((t=>{var e,n;const o=i.find((e=>this.isRangeContainedIn(t,e.getRange()))),a=r.find((e=>this.isRangeContainedIn(t,e.getRange())));return{
attribute:null!==(e=null==o?void 0:o.getName().split(co.attribute)[0])&&void 0!==e?e:"",object:null!==(n=null==a?void 0:a.getName().split(co.object)[0])&&void 0!==n?n:""}})).filter((t=>""!==t.object&&""!==t.attribute));this.commitLastModified(n,o)}};M([_n(Sn.Storage),N("design:type",eo)],uo.prototype,"StorageManager",void 0),M([_n(Sn.Turnstile),N("design:type",Function)],uo.prototype,"turnstile",void 0),uo=M([k()],uo);const ho=uo;class lo extends Error{constructor(t){super(t),
this.name="MatrixError"}}class fo{get computedCapabilities(){const t=this.groups.flatMap((t=>t.capabilities)),e=this.capabilities;return _t(t.concat(e))}constructor(t){this.type="user",this.email=t.email,this.id=t.id,this.termsOfAddress=t.termsOfAddress,this.capabilities=t.capabilities,this.onboarded=t.onboarded,this.attributes=t.attributes,this.groups=t.groups}}const po={en:{pronouns:{values:[{subject:"they",object:"them",possessive:{determiner:"their",pronoun:"theirs"},reflexive:"themself"}]}}
};var go;!function(t){var e,n;(e=t.UM||(t.UM={})).addUsers="cap:um:addUsers",e.removeUsers="cap:um:removeUsers",e.addGroups="cap:um:addGroups",e.removeGroups="cap:um:removeGroups",e.promoteGroups="cap:um:promoteGroups",e.demoteGroups="cap:um:demoteGroups",e.promoteUsers="cap:um:promoteUsers",e.demoteUsers="cap:um:demoteUsers",e.editUserAttributes="cap:um:editUserAttrs",e.editUserTOAs="cap:um:editUserTOAs",e.editOwnTOAs="cap:um:editOwnTOAs",e.editOwnAttributes="cap:um:editOwnAttrs",
(n=t.SM||(t.SM={})).editOwnSettings="cap:sm:editOwnSettings",n.editGlobalSettings="cap:sm:editGlobalSettings",n.editDocumentSettings="cap:sm:editDocumentSettings"}(go||(go={}));let yo=class{};yo.userStorage="user-metadata";let vo=class{load(t){var e,n;Session.getActiveUser().getEmail();const r=this.StorageManager.document.getStored(yo.userStorage);this.groups=r.groups,this.attributeMap=t;for(const i in t){const o=this.engine.getSheetById(i)
;if(!o)throw Error(`sheet ${i} from a user attribute map not found.`);const a=this.engine.getAllObjectsForSheet(o),s=t[i];Session.getActiveUserLocale();for(const t of a){const o=t.attributes[s.email],a=r.main[t.id],c=a.groups.map((t=>this.groups[t])),u=new fo({email:o,id:t.id,termsOfAddress:null!==(e=a.termsOfAddress)&&void 0!==e?e:po,attributes:t.attributes,capabilities:null!==(n=a.capabilities)&&void 0!==n?n:[],groups:null!=c?c:[],onboarded:a.onboarded});wt(this.allUsers,[i,u.id],u),
this.activeUser&&this.activeUser.email===o&&(this.activeUser=u),this.emailLUT[s.email]=u.id}}}newUser(t){this.guard(go.UM.addUsers);const e=t.groups.flatMap((t=>t.capabilities)),n=t.capabilities;if(!_t(e.concat(n)).every((t=>this.activeUser.computedCapabilities.includes(t))))throw Error("cannot add user because they have permissions you don't");{const e=Ht();this.engine.newObject({id:e,position:{offset:0},type:"append",sheetId:t.sheetId,attributes:{[this.attributeMap[t.sheetId].email]:t.email,
[this.attributeMap[t.sheetId].fullName]:t.fullName}});const n=new fo({email:t.email,id:e,termsOfAddress:t.termsOfAddress,attributes:{[this.attributeMap[t.sheetId].email]:t.email,[this.attributeMap[t.sheetId].fullName]:t.fullName},capabilities:t.capabilities,groups:t.groups,onboarded:!1});this.allUsers[e]=n,this.emailLUT[t.email]=e,this.shareWithUser(this.engine.backend.spreadsheet,"edit",n),this.engine.commit()}}removeUser(t){if(this.guard(go.UM.removeUsers),
!Jt(this.activeUser,t))throw Error("cannot remove user because they have permissions you don't");{if(this.activeUser.id===t.id)throw Error("cannot remove active user");const e=t.id,n=t.email,r=t.groups;delete this.allUsers[e],delete this.emailLUT[n];for(const t of r){const n=this.groupLUT[t.id].filter((t=>t.id!==e));this.groupLUT[t.id]=n}this.unshareWithUser(this.engine.backend.spreadsheet,"edit",t),this.engine.deleteObject({id:e,type:"splice"}),this.engine.commit()}}shareWithUser(t,e,n){
const r=n.email;if(!r)throw Error("invalid user input for sharing");switch(e){case"edit":t.addEditor(r);break;case"view":t.addViewer(r);break;default:throw Error("invalid permission level for sharing")}}unshareWithUser(t,e,n){const r=n.email;if(!r)throw Error("invalid user input for unsharing");switch(e){case"edit":t.removeEditor(r);break;case"view":t.removeViewer(r);break;default:throw Error("invalid permission level for unsharing")}}addGroup(t){if(this.guard(go.UM.addGroups),
!Jt(this.activeUser,t))throw Error("you do not have the capability to add this group");this.groups[t.id]=t}removeGroup(t){if(this.guard(go.UM.removeGroups),!Jt(this.activeUser,t))throw Error("you do not have the capability to remove this group");delete this.groups[t.id]}addCapabilitiesToUser(t,...e){this.guard(go.UM.promoteUsers),Qt(this.activeUser,e)&&Jt(this.activeUser,t)&&this.allUsers[t.id].capabilities.push(...e)}removeCapabilitiesFromUser(t,...e){this.guard(go.UM.demoteUsers),
Jt(this.activeUser,t),Qt(this.activeUser,e)&&(this.allUsers[t.id].capabilities=t.capabilities.filter((t=>!e.includes(t))))}setTermsOfAddress(t,e){this.guard(go.UM.editUserTOAs),Jt(this.activeUser,t)&&bi(this.allUsers[t.id].termsOfAddress,e)}setOwnTermsOfAddress(t){this.guard(go.UM.editOwnTOAs),Jt(this.activeUser,this.activeUser)&&bi(this.activeUser.termsOfAddress,t)}setAttributes(t,e){this.guard(go.UM.editUserAttributes),Jt(this.activeUser,t)&&bi(this.allUsers[t.id].attributes,e)}
setOwnAttributes(t){this.guard(go.UM.editOwnAttributes),Jt(this.activeUser,this.activeUser)&&bi(this.activeUser.attributes,t)}commit(){const t={};for(const e in this.allUsers){const n=this.allUsers[e];t[e]={termsOfAddress:n.termsOfAddress,capabilities:n.capabilities,attributes:n.attributes,groups:n.groups,onboarded:n.onboarded,locale:n.locale}}this.StorageManager.document.store(yo.userStorage,{main:t,emailLUT:this.emailLUT,groups:this.groups})}userCan(t){
return this.activeUser.computedCapabilities.includes(t)}toa(t,e){return t.termsOfAddress[e]}pronouns(t,e){const n=t.termsOfAddress[e].pronouns;if(!n)throw Error("no pronouns found for user "+t.id);if(n.tactic)switch(n.tactic){case"alternateDaily":function r(t){const e=(new Date).getDay()%n.values.length-1;return n.values[e]}return r();case"alternateSentence":return new mo(t,e);case"alternateWord":return new wo(t,e);default:return n.staticIndex?n.values[n.staticIndex]:n.values[0]}}guard(t){
if(!this.userCan(t))throw Error(`You don't have the "${t}" capability on your user or in any of the groups you're in. Either fix the spelling of the capability, add the "${t}" capability to your user or a group you're in, or stop trying to hack the system.`)}};M([_n(Sn.Storage),N("design:type",Function)],vo.prototype,"StorageManager",void 0),M([_n(Sn.Surgical),N("design:type",Function)],vo.prototype,"engine",void 0),vo=M([k()],vo);const bo=vo;class mo{endSentence(){
this.index=mt(this.toa[this.locale].pronouns.values.length-1)}get pronoun(){return this.toa[this.locale].pronouns.values[this.index]}constructor(t,e){this.index=0,this.toa=t.termsOfAddress,this.locale=e}}class wo{get pronoun(){return this.toa[this.locale].pronouns.values[mt(this.toa[this.locale].pronouns.values.length-1)]}constructor(t,e){this.toa=t.termsOfAddress,this.locale=e}}let _o=class{};_o.userAttributeMap="user-attribute-map",_o.userSettings="user-settings",
_o.globalSettings="global-settings",_o.documentSettings="document-settings";let So=class{constructor(t,e){this.UserManager=t,this.StorageManager=e}registerSettings(t){const e={};let n="";const r={group(t,i,o){(t.includes(".")||"children"===t)&&wt(e,`${n}.${t}`,{id:t,type:i}),n=`${n}.${t}.children`,o(r),n=n.replace(`.${t}.children`,"")},setting(t,r,i){wt(e,`${n}.${t}`,{id:t,type:r,defaultValue:i})}};t(r),this._settings=e}getSettings(){return this._settings}_valuePathToOptionPath(t){
return t.replaceAll(".",".children.")}_OptionPathToValuePath(t){return t.replaceAll(".children.",".")}getOption(t){const e=ht(this._values,t),n=ht(this._settings,t.replaceAll(".",".children."));if(n)return null!=e?e:n.defaultValue;throw Error(`Unknown setting: ${t}. Try adding the setting definition to your code.`)}getSettingMetadata(t){if(t.includes(".children"))throw Error(`Input setting ID '${t}' is using SettingsManager Option notation, not the required Value notation.`)
;return ht(this._settings,this._valuePathToOptionPath(t))}_setSetting(t,e){const n=ht(this._settings,this._valuePathToOptionPath(t));if(Yt(e)!==n.type)throw Error(`Invalid value (${e.toString()}) for setting ${t}. Expected type ${n.type}, got type ${Yt(e)} instead.`);wt(this._values,t,e)}setSetting(t,e){switch(this.getSettingMetadata(t).scope){case"user":this.UserManager.userCan(go.SM.editOwnSettings)&&this._setSetting(t,e);break;case"global":
this.UserManager.userCan(go.SM.editGlobalSettings)&&this._setSetting(t,e);break;case"document":this.UserManager.userCan(go.SM.editDocumentSettings)&&this._setSetting(t,e);default:this.UserManager.userCan(go.SM.editGlobalSettings)&&this._setSetting(t,e)}}populate(){const t=this.StorageManager.user.getStored(_o.userSettings),e=this.StorageManager.script.getStored(_o.globalSettings),n=this.StorageManager.document.getStored(_o.documentSettings);Kt(t,((t,e)=>{
"user"===this.getSettingMetadata(e).scope&&this._setSetting(e,t)})),Kt(e,((t,e)=>{"global"===this.getSettingMetadata(e).scope&&this._setSetting(e,t)})),Kt(n,((t,e)=>{"document"===this.getSettingMetadata(e).scope&&this._setSetting(e,t)}))}commit(){const t={},e={},n={};Kt(this._values,((r,i)=>{const o=this.getSettingMetadata(i);if(!o)throw Error(`Unknown setting: ${i}. Try adding the setting definition to your code. For security reasons, your settings won't be committed.`);switch(o.scope){
case"user":this.UserManager.userCan(go.SM.editOwnSettings)&&wt(t,i,r);break;case"global":default:this.UserManager.userCan(go.SM.editGlobalSettings)&&wt(e,i,r);break;case"document":this.UserManager.userCan(go.SM.editDocumentSettings)&&wt(n,i,r)}})),this.StorageManager.user.store(_o.userSettings,t),this.StorageManager.script.store(_o.globalSettings,e),this.StorageManager.document.store(_o.documentSettings,n)}};So=M([k(),N("design:paramtypes",[bo,eo])],So);const Ao=So;let Co=class{}
;Co.socketCache="socket-cache";let jo=class{constructor(){this.checkupCallback=void 0}checkup(t){t&&this.checkupCallback&&this.checkupCallback(t);const e=this.StorageManager.user.getCached(Co.socketCache);return this.StorageManager.user.cache(Co.socketCache,{}),e}sendDown(t){var e;const n=this.StorageManager.user.getCached(Co.socketCache);if(n){n.messages.push(t);const e=n.messages.map((t=>{var e;return null!==(e=t.nextPoll)&&void 0!==e?e:0}));n.nextPoll=Math.min(...e),
this.StorageManager.user.cache(Co.socketCache,n)}else this.StorageManager.user.cache(Co.socketCache,{nextPoll:null!==(e=t.nextPoll)&&void 0!==e?e:5e3,messages:[t]})}onCheckup(t){this.checkupCallback=t}};M([_n(Sn.Storage),N("design:type",eo)],jo.prototype,"StorageManager",void 0),jo=M([k()],jo);const Oo=jo;class To{}To.universal="TURNSTILE_CONCURRENCY_";let Io=class{enter(t,e){return new Promise(((e,n)=>{
this.get(this.name)?this.get(this.name)[0]!==this.id&&this.set(this.name,[...this.get(this.name),this.id]):this.set(this.name,[this.id]);for(let n=0;n<t/1e3;n+=10)Utilities.sleep(10),this.get(this.name)[0]!==this.id&&this.get(this.name)||e(!0);this.exit(),n()}))}exit(){const t=this.get(this.name),e=t.splice(t.indexOf(this.id));0!==e.length?this.set(this.name,e):this.delete(this.name)}get(t){switch(this.type){case"document":
return JSON.parse(CacheService.getDocumentCache().get(To.universal+t)||"{}");case"script":return JSON.parse(CacheService.getScriptCache().get(To.universal+t)||"{}");case"user":return JSON.parse(CacheService.getUserCache().get(To.universal+t)||"{}")}}set(t,e){switch(this.type){case"document":CacheService.getDocumentCache().put(To.universal+t,JSON.stringify(e));break;case"script":CacheService.getScriptCache().put(To.universal+t,JSON.stringify(e));break;case"user":
CacheService.getUserCache().put(To.universal+t,JSON.stringify(e))}}delete(t){switch(this.type){case"document":CacheService.getDocumentCache().remove(To.universal+t);break;case"script":CacheService.getScriptCache().remove(To.universal+t);break;case"user":CacheService.getUserCache().remove(To.universal+t)}}constructor(t,e){this.name=t,this.type=e,this.id=Ht()}};Io=M([k(),N("design:paramtypes",[String,String])],Io);const ko=new wn({autoBindInjectable:!1}),Mo=ko
;ko.bind(Sn.Surgical).to(Ii).inSingletonScope(),ko.bind(Sn.User).to(bo).inSingletonScope(),ko.bind(Sn.Storage).to(eo).inSingletonScope(),ko.bind(Sn.Matrix).to(ho).inSingletonScope(),ko.bind(Sn.Settings).to(Ao).inSingletonScope(),ko.bind(Sn.Socketeer).to(Oo).inSingletonScope(),ko.bind(Sn.Turnstile).toConstructor(Io),global.onOpen=function(){SpreadsheetApp.getUi().createMenu("Articleman").addItem("Open Articleman...","showSidebar").addItem("Open help...","showHelp").addToUi()}
;const No=Mo.get(Sn.Socketeer);global.socketeer=No.checkup.bind(No),global.onSelectionChange=()=>{const t=SpreadsheetApp.getActiveSheet(),e=t.getActiveCell().getRow(),n=t.getActiveCell().getColumn();CacheService.getUserCache().put("currentRow",JSON.stringify({row:e,column:n,sheet:t.getName()}),21600)},global.showSidebar=()=>{SpreadsheetApp.getUi().showSidebar(HtmlService.createHtmlOutput(UrlFetchApp.fetch("https://asc.articleman.org")).setTitle("Articleman"))},global.onInstall=function(){
global.showSidebar()}}));
/* @preserve thank you for using Articleman. you're awesome! */